<<<<<<< HEAD
<<<<<<< HEAD
PS D:\Study\GraduationProject\fe_graduation_v2\src> tree /f
Folder PATH listing for volume New Volume
Volume serial number is 7C5B-6CE0
=======
PS D:\DiskDVuHuyHoang\meeee\FE\src> tree /f
Folder PATH listing
Volume serial number is 8451-AFF0
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
PS D:\DiskDVuHuyHoang\meeee\FE\src> tree /f
Folder PATH listing
Volume serial number is 8451-AFF0
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
D:.
│   App.css
│   App.tsx
│   index.css
│   main.tsx
│   vite-env.d.ts
│   
├───api
│       authApi.ts
│       blogApi.ts
│       cartApi.ts
│       classApi.ts
│       courseApi.ts
│       orderApi.ts
│       paymentApi.ts
<<<<<<< HEAD
│       scheduleApi.ts
=======
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
│       userApi.ts
│
├───assets
│       avt.jpg
│       logo.svg
│       react.svg
│
├───components
│   ├───common
│   │   ├───Auth
│   │   │   ├───LoginModal
│   │   │   │       LoginModal.css
│   │   │   │       LoginModal.tsx
│   │   │   │
│   │   │   └───RegisterModal
│   │   │           RegisterModal.css
│   │   │           RegisterModal.tsx
│   │   │
│   │   ├───CartBadge
│   │   │       CartBadge.css
│   │   │       CartBadge.tsx
│   │   │
│   │   ├───Dashboard
│   │   │   ├───Navigation
│   │   │   │       Navigation.css
│   │   │   │       Navigation.tsx
│   │   │   │
│   │   │   └───Profile
│   │   │       └───ProfileCard
│   │   │               ProfileCard.css
│   │   │               ProfileCard.tsx
│   │   │
│   │   ├───Notification
│   │   │       Notification.css
│   │   │       Notification.tsx
│   │   │
│   │   ├───ProtectedRoute
│   │   │       ProtectedRoute.css
│   │   │       ProtectedRoute.tsx
│   │   │
│   │   ├───TipTapEditor
│   │   │       TipTapEditor.css
│   │   │       TipTapEditor.tsx
│   │   │
│   │   └───UserMenu
│   │           UserMenu.css
│   │           UserMenu.tsx
│   │
│   ├───manage
│   │   ├───ClassDetail
<<<<<<< HEAD
<<<<<<< HEAD
│   │   │       AddStudentsModal.css
│   │   │       AddStudentsModal.tsx
│   │   │       ClassInfoTab.tsx
│   │   │       CreateRecurringScheduleModal.tsx
│   │   │       CreateScheduleModal.tsx
│   │   │       NotificationFormModal.tsx
│   │   │       NotificationTab.css
│   │   │       NotificationTab.tsx
│   │   │       ScheduleDetailModal.tsx
│   │   │       ScheduleTab.tsx
│   │   │       StudentListTab.css
│   │   │       StudentListTab.tsx
│   │   │
│   │   ├───ClassManagement
│   │   │       CancelClassModal.tsx
│   │   │       ClassFilter.tsx
│   │   │       ClassFormModal.tsx
│   │   │       ClassTable.tsx
=======
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
│   │   │       ClassInfoTab.tsx
│   │   │       ScheduleTab.tsx
│   │   │       StudentListTab.tsx
│   │   │
│   │   ├───ClassManagement
│   │   │   ├───CancelClassModal
│   │   │   │       CancelClassModal.tsx
│   │   │   │
│   │   │   ├───ClassFilter
│   │   │   │       ClassFilter.tsx
│   │   │   │
│   │   │   ├───ClassFormModal
│   │   │   │       ClassFormModal.tsx
│   │   │   │
│   │   │   └───ClassTable
│   │   │           ClassTable.tsx
<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
│   │   │
│   │   └───CourseManagement
│   │       └───CourseDetailDrawer
│   │               CourseDetailDrawer.css
│   │               CourseDetailDrawer.tsx
│   │
<<<<<<< HEAD
<<<<<<< HEAD
│   ├───public-page
│   ├───student
│   │   ├───Cart
│   │   │       CartDrawer.css
│   │   │       CartDrawer.tsx
│   │   │
│   │   ├───Course
│   │   │   ├───CourseCard
│   │   │   │       CourseCard.css
│   │   │   │       CourseCard.tsx
│   │   │   │
│   │   │   └───CourseList
│   │   │           CourseList.css
│   │   │           CourseList.tsx
│   │   │
│   │   └───Order
│   │       ├───OrderCard
│   │       │       OrderCard.css
│   │       │       OrderCard.tsx
│   │       │
│   │       └───PurchaseModal
│   │               PurchaseModal.css
│   │               PurchaseModal.tsx
│   │
│   └───teacher
=======
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
│   └───student
│       ├───Cart
│       │       CartDrawer.css
│       │       CartDrawer.tsx
│       │
│       ├───Course
│       │   ├───CourseCard
│       │   │       CourseCard.css
│       │   │       CourseCard.tsx
│       │   │
│       │   └───CourseList
│       │           CourseList.css
│       │           CourseList.tsx
│       │
│       └───Order
│           ├───OrderCard
│           │       OrderCard.css
│           │       OrderCard.tsx
│           │
│           └───PurchaseModal
│                   PurchaseModal.css
│                   PurchaseModal.tsx
│
<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
├───constants
│       categories.ts
│       permissions.ts
│
<<<<<<< HEAD
<<<<<<< HEAD
├───hooks
=======
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
├───layouts
│   └───MainLayout
│           MainLayout.css
│           MainLayout.tsx
│
├───lib
│       axios.ts
│
├───pages
│   ├───common
│   │   ├───Dashboard
│   │   │       Dashboard.css
│   │   │       Dashboard.tsx
│   │   │
│   │   └───Profile
│   │           Profile.css
│   │           Profile.tsx
│   │
│   ├───manage
│   │   ├───BlogApproval
│   │   │       BlogApproval.css
│   │   │       BlogApproval.tsx
│   │   │
│   │   ├───Business
│   │   │       Business.css
│   │   │       Business.tsx
│   │   │
│   │   ├───ClassDetail
│   │   │       ClassDetail.css
│   │   │       ClassDetail.tsx
│   │   │
│   │   ├───ClassManagement
│   │   │       ClassManagement.css
│   │   │       ClassManagement.tsx
│   │   │
│   │   ├───CourseManagement
│   │   │       CourseManagement.css
│   │   │       CourseManagement.tsx
│   │   │
│   │   ├───MemberManagement
│   │   │       MemberManagement.css
│   │   │       MemberManagement.tsx
│   │   │
│   │   ├───QuestionBank
│   │   │       QuestionBank.css
│   │   │       QuestionBank.tsx
│   │   │
│   │   ├───Statistics
│   │   │       Statistics.css
│   │   │       Statistics.tsx
│   │   │
│   │   └───WriteBlog
│   │           WriteBlog.css
│   │           WriteBlog.tsx
│   │
│   ├───public-page
│   │   ├───Blog
│   │   │       Blog.tsx
│   │   │
│   │   ├───Courses
│   │   │       Course.css
│   │   │       Course.tsx
│   │   │
│   │   ├───Home
│   │   │       Home.css
│   │   │       Home.tsx
│   │   │
│   │   └───Test
│   │           Test.tsx
│   │
│   ├───student
│   │   ├───Cart
│   │   │       Cart.css
│   │   │       Cart.tsx
│   │   │
│   │   ├───Orders
│   │   │       Orders.css
│   │   │       Orders.tsx
│   │   │
│   │   ├───OrderStatus
│   │   │       OrderStatus.css
│   │   │       OrderStatus.tsx
│   │   │
│   │   └───VideoCourses
│   │           VideoCourses.css
│   │           VideoCourses.tsx
│   │
│   └───teacher
│       └───OfflineClasses
│               OfflineClasses.css
│               OfflineClasses.tsx
│
├───routes
│       index.ts
│
├───services
│       authService.ts
│       blogService.ts
│       businessService.ts
│       cartService.ts
│       classManagementService.ts
│       courseManagementService.ts
│       courseStudentService.ts
│       memberManagementService.ts
│       orderService.ts
│       paymentService.ts
│       questionBankService.ts
<<<<<<< HEAD
│       scheduleService.ts
=======
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
│       statisticsService.ts
│       userService.ts
│
├───store
│       authStore.ts
│       cartStore.ts
│       orderStore.ts
│
└───types
        auth.ts
        blog.ts
        cart.ts
        class.ts
        course.ts
        css.d.ts
        order.ts
        payment.ts
<<<<<<< HEAD
        schedule.ts
        svg.d.ts
        user.ts

<<<<<<< HEAD
PS D:\Study\GraduationProject\fe_graduation_v2\src> 

import type { User } from './user';

// Định nghĩa các trạng thái của lớp học để sử dụng nhất quán
export const CLASS_STATUSES = ['PENDING', 'ACTIVE', 'FINISHED', 'CANCELED'] as const;
export type ClassStatus = (typeof CLASS_STATUSES)[number];

export interface Class {
    id: number;
    name: string;
    description: string;
    subject: string | null;
    title: string;
    teacher: User;
    createdAt: string;
    updatedAt: string | null;
    createdByName: string | null;
    updatedByName: string | null;
    status: ClassStatus;
    memberIds?: number[];
}

export interface FilterClassesRequest {
    searchString?: string;
    idTeacher?: number;
    statusClass?: ClassStatus[];
    fromDate?: string | null;
    toDate?: string | null;
    page?: number;
    size?: number;
}

export interface CreateClassRequest {
    name: string;
    description: string;
    title: string;
    teacher: number;
    memberIds?: number[];
}

export interface UpdateClassRequest extends Partial<Omit<CreateClassRequest, 'teacher'>> {
    id: number;
    teacher?: number;
}

=======
        svg.d.ts
        user.ts

=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
PS D:\DiskDVuHuyHoang\meeee\FE\src> 
export interface User {
    id: number;
    firstName: string;
    lastName: string;
    phone: string;
    address: string;
    dob: string;
    gender: string;
    avatarUrl: string;
    isActive: boolean;
    isDelete: boolean;
    education: string;
    major: string;
    role: string;
    student?: {
        education: string;
        major: string;
    };
    createdAt?: string;
    updatedAt?: string;
}

export interface FilterRequest {
    searchString?: string;
    email?: string;
    name?: string;
    phone?: string;
    isActive?: boolean;
    isDelete?: boolean;
    userRoles?: string[] | null;
    fromDate?: string;
    toDate?: string;
    title?: string;
    categoryPost?: string[];
    categories?: string[];
    page?: number;
    size?: number;
    sort?: string | null;
}

export interface FilterResponse {
    code: number;
    message: string;
    data: {
        totalPages: number;
        totalElements: number;
        size: number;
        content: User[];
        number: number;
        sort: {
            empty: boolean;
            unsorted: boolean;
            sorted: boolean;
        };
        pageable: {
            offset: number;
            sort: {
                empty: boolean;
                unsorted: boolean;
                sorted: boolean;
            };
            unpaged: boolean;
            paged: boolean;
            pageNumber: number;
            pageSize: number;
        };
        first: boolean;
        last: boolean;
        empty: boolean;
    };
}

export interface DisableUserRequest {
    id: number;
    isActive: boolean;
}

export interface DisableUserResponse {
    code: number;
    message: string;
    data: User;
}

export interface DeleteUserRequest {
    id: number;
    isDelete: boolean;
    isActive: boolean;
}

export interface DeleteUserResponse {
    code: number;
    message: string;
    data: User;
}

export interface UserProfileResponse {
    code: number;
    message: string;
    data: {
        id: string;
        firstName: string;
        lastName: string;
        phone: string | null;
        address: string | null;
        dob: string | null;
        gender: string | null;
        avatarUrl: string | null;
        isActive: boolean | null;
        isDelete: boolean | null;
        education: string | null;
        major: string | null;
        student: any | null;
    };
}

export interface UpdateUserInfoRequest {
    // id: number;
    // email?: string;
    // password?: string;
    // oldPassword?: string;
    firstName?: string;
    lastName?: string;
    phone?: string;
    address?: string;
    dob?: string;
    gender?: string;
    avatarUrl?: string;
    education?: string;
    major?: string;
    isActive?: boolean;
    isDelete?: boolean;
    token?: string;
}

export interface UpdateUserInfoResponse {
    code: number;
    message: string;
    data: User;
}

// src/types/class.ts
import type { User } from './user';

// Định nghĩa các trạng thái của lớp học để sử dụng nhất quán
export const CLASS_STATUSES = ['PENDING', 'ACTIVE', 'FINISHED', 'CANCELED'] as const;
export type ClassStatus = (typeof CLASS_STATUSES)[number];

export interface Class {
    id: number;
    name: string;
    description: string;
    subject: string | null;
    title: string;
    teacher: User;
    createdAt: string;
    updatedAt: string | null;
    createdByName: string | null;
    updatedByName: string | null;
    // status: ClassStatus;
    memberIds?: number[];
}

export interface FilterClassesRequest {
    searchString?: string;
    idTeacher?: number;
    statusClass?: ClassStatus[];
    fromDate?: string | null;
    toDate?: string | null;
    page?: number;
    size?: number;
}

export interface CreateClassRequest {
    name: string;
    description: string;
    title: string;
    teacher: number;
    memberIds?: number[];
    // status: ClassStatus;
}

export interface UpdateClassRequest extends Partial<Omit<CreateClassRequest, 'teacher'>> {
    id: number;
    teacher?: number;
}

<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
// Response cho API lấy danh sách (đã phân trang)
export interface ClassPagedResponse {
    code: number;
    message: string;
    data: {
        content: Class[];
        totalPages: number;
        totalElements: number;
        pageable: {
            pageNumber: number;
            pageSize: number;
        };
<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
    };
}

// Response cho API tạo/sửa/chi tiết
export interface ClassDetailResponse {
    code: number;
    message: string;
    data: Class;
}

export interface ClassMember {
<<<<<<< HEAD
    // id người dùng trong hệ thống
    id: number;
    name: string;
    joinDate: string;
    email: string;
    phone: string | null;
    // memberId: id bản ghi quan hệ thành viên-trong-lớp (dùng cho API xóa)
    memberId: number;
    address: string | null;
    status: 'ACTIVE' | 'INACTIVE';
    roleInClass: 'STUDENT' | 'TEACHER';
}

// Request body để lấy danh sách thành viên
export interface GetMembersRequest {
    classId: number;
    searchString?: string;
    joinDate?: string | null;
    status?: string[];
    page?: number;
    size?: number;
}

// Request body để thêm hoặc xóa thành viên
export interface UpdateMembersRequest {
    id: number; // classId
    memberIds: number[];
}

// Response API cho danh sách thành viên (có phân trang)
export interface MemberPagedResponse {
    code: number;
    message: string;
    data: {
        content: ClassMember[];
        totalPages: number;
        totalElements: number;
        pageable: {
            pageNumber: number;
            pageSize: number;
        }
    };
}

/* ====== Class Notification types ====== */

export type NotificationTypeNumber = 1 | 2; // 1: Thông báo thường, 2: Bài tập (có thời gian)
export interface ClassNotification {
    id: number;
    description: string;
    // Chuỗi mô tả kiểu từ backend, ví dụ: "Exercise"
    typeNotification: string;
    fromDate: string | null;
    toDate: string | null;
    isPin: boolean;
    isActive: boolean;
    isDelete: boolean;
    createdAt: string;
    updatedAt: string | null;
    createdBy: User;
    updatedBy: User | null;
    // Backend trả về mảng object/file hoặc rỗng, không có schema cụ thể -> để any[]
    attachDocumentClasses: any[];
}

export interface CreateClassNotificationRequest {
    classId: number;
    description: string;
    isPin: boolean;
    typeNotification: NotificationTypeNumber;
    fromDate: string | null; // "YYYY-MM-DD HH:mm:ss" hoặc null
    toDate: string | null;   // "YYYY-MM-DD HH:mm:ss" hoặc null
    urlAttachment: string[]; // các URL cuối cùng
}

export interface UpdateClassNotificationRequest extends Omit<CreateClassNotificationRequest, 'classId'> {
    classId: number;
    classNotificationId: number;
}

export interface GetClassNotificationsRequest {
    classId: number;
    searchString?: string;
    fromDate?: string | null;
    toDate?: string | null;
    page?: number;
    size?: number;
}

export interface ClassNotificationPagedResponse {
    code: number;
    message: string;
    data: {
        content: ClassNotification[];
        totalPages: number;
        totalElements: number;
        pageable: {
            pageNumber: number;
            pageSize: number;
        };
    };
}

export interface ToggleClassNotificationRequest {
    classId: number;
    classNotificationId: number;
    isActive: boolean;
    isDelete: boolean;
}

export interface ClassNotificationDetailResponse {
    code: number;
    message: string;
    data: ClassNotification;
}
// services/courseManagementService.ts - Cải thiện
import { message } from 'antd';
=======
    };
}

// Response cho API tạo/sửa/chi tiết
export interface ClassDetailResponse {
    code: number;
    message: string;
    data: Class;
}

export interface ClassMember {
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
    id: number;
    name: string;
    joinDate: string;
    email: string;
    phone: string | null;
    memberId: number;
    address: string | null;
    status: 'ACTIVE' | 'INACTIVE';
    roleInClass: 'STUDENT' | 'TEACHER';
}

// Request body để lấy danh sách thành viên
export interface GetMembersRequest {
    classId: number;
    searchString?: string;
    joinDate?: string | null;
    status?: string[];
    page?: number;
    size?: number;
}

// Request body để thêm hoặc xóa thành viên
export interface UpdateMembersRequest {
    id: number; // classId
    memberIds: number[];
}


// Response API cho danh sách thành viên (có phân trang)
export interface MemberPagedResponse {
    code: number;
    message: string;
    data: {
        content: ClassMember[];
        totalPages: number;
        totalElements: number;
        pageable: {
            pageNumber: number;
            pageSize: number;
        }
    };
}
// types/course.ts - Cải thiện
export interface AllCoursesRequest {
    fromDate: string | null;
    toDate: string | null;
    title: string | null;
    categories: string[];
    page?: number;
    size?: number;
    sort?: string | null;
}

export interface Course {
    id: number;
    title: string;
    description: string;
    price: number;
    thumbnailUrl: string | null;
    categoryName: string | null;
    categoryId?: number; // ✅ Thêm categoryId - từ backend response
    updatedAt: string | null;
    createdAt: string;
    isDelete: boolean;
    isActive: boolean;
    isBought: boolean | null;
    authorName: string | null;
    createdByName: string | null;
    updatedByName: string | null;
    author: Author | null;
    createdBy: Author | null;
    updatedBy: Author | null;
    lessons: Lesson[] | null;
}

// ✅ Thêm interface cho Author từ API response
export interface Author {
    id: number;
    firstName: string;
    lastName: string;
    phone: string | null;
    address: string | null;
    dob: string | null;
    gender: string | null;
    avatarUrl: string | null;
    isActive: boolean;
    isDelete: boolean;
    education: string | null;
    major: string | null;
    role: string;
    student: any | null;
    consultant: any | null;
    teacher: any | null;
    manager: any | null;
    createdAt: string;
    updatedAt: string | null;
    code: string;
}

// ✅ Thêm interface cho Lesson từ API response
export interface Lesson {
    id: number;
    title: string;
    content: string;
    videoUrl: string;
    duration: number;
    orderIndex: number;
    isPreviewAble: boolean;
    courseId: string;
    isBought: boolean;
    isDeleted: boolean;
    isActive: boolean;
    createdAt: string;
    updatedAt: string | null;
    createdBy: Author | null;
    updatedBy: Author | null;
    createdByName: string | null;
    updatedByName: string | null;
}

export interface CourseResponse {
    code: number;
    message: string;
    data: {
        content: Course[];
        pageable: {
            pageNumber: number;
            pageSize: number;
            sort: {
                empty: boolean;
                sorted: boolean;
                unsorted: boolean;
            };
            offset: number;
            paged: boolean;
            unpaged: boolean;
        };
        totalPages: number;
        totalElements: number;
        last: boolean;
        size: number;
        number: number;
        sort: {
            empty: boolean;
            sorted: boolean;
            unsorted: boolean;
        };
        numberOfElements: number;
        first: boolean;
        empty: boolean;
    };
}

export interface CourseDetailResponse {
    code: number;
    message: string;
    data: Course;
}

export interface CourseCreateRequest {
    title: string;
    description: string;
    price: number;
    authorId: number;
    categoryId: number;
    thumbnailUrl: string;
    isActive?: boolean; // ✅ Optional với default
    isDelete?: boolean; // ✅ Optional với default
}

export interface CourseUpdateRequest {
    id: number;
    title?: string; // ✅ Optional cho update
    description?: string; // ✅ Optional cho update
    price?: number; // ✅ Optional cho update
    categoryId?: number; // ✅ Optional cho update
    thumbnailUrl?: string; // ✅ Optional cho update
    isActive?: boolean; // ✅ Optional cho update
    isDelete?: boolean; // ✅ Optional cho update
}

// ✅ Thêm interface riêng cho status update
export interface CourseStatusUpdateRequest {
    id: number;
    isActive?: boolean;
    isDelete?: boolean;
}

export interface UploadResponse {
    code: number;
    message: string;
    data: string;
}

export interface Category {
    id: number;
    name: string;
}

export interface CategoryResponse {
    code: number;
    message: string;
    data: Category[];
}
export interface RegisterRequest {
    email: string;
    password: string;
    firstName: string;
    lastName: string;
    role?: number;
}

export interface LoginRequest {
    email: string;
    password: string;
}

export interface AuthResponse {
    code: number;
    message: string;
    data: {
        token: string;
        authenticated: boolean;
        role: number;
    } | null;
}

export interface LogoutResponse {
    code: number;
    message: string;
    data: null;
}

export interface UpdatePasswordRequest {
    password: string;
    oldPassword: string;
}

import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface User {
    id: string;
    firstName: string;
    lastName: string;
    email: string;
    password: string;
    role: 'student' | 'teacher' | 'manager' | 'consultant' | null;
}

interface AuthState {
    user: User | null;
    isAuthenticated: boolean;
    token: string | null;
    login: (user: User) => void;
    logout: () => void;
    setToken: (token: string) => void;
}

const useAuthStore = create<AuthState>()(
    persist(
        (set) => ({
            user: null,
            isAuthenticated: false,
            token: null,
            login: (user) => set({ user, isAuthenticated: true }),
            logout: () => set({ user: null, isAuthenticated: false, token: null }),
            setToken: (token) => set({ token }),
        }),
        { name: 'auth-storage' }
    )
);

export default useAuthStore;
import { message } from 'antd';
import { login, register, logout, refreshToken, updatePassword } from '../api/authApi';
import useAuthStore from '../store/authStore';
import type {
    RegisterRequest,
    LoginRequest,
    AuthResponse,
    LogoutResponse,
    UpdatePasswordRequest,
} from '../types/auth';
import type { UserProfileResponse } from 'types/user';
import { getUserProfile } from '../api/userApi';

const roleMapping: { [key: number]: 'student' | 'teacher' | 'manager' | 'consultant' } = {
    1: 'manager',
    2: 'consultant',
    3: 'teacher',
    4: 'student',
};

export const registerService = async (data: RegisterRequest): Promise<LogoutResponse> => {
    try {
        const response = await register(data);
        if (response.code === 200) {
            message.success('Đăng ký thành công! Vui lòng đăng nhập.');
            return response;
        }
        throw new Error(response.message || 'Đăng ký thất bại.');
    } catch (error: any) {
        message.error(error.message || 'Đã có lỗi xảy ra khi đăng ký.');
        throw error;
    }
};

export const loginService = async (data: LoginRequest): Promise<AuthResponse> => {
    try {
        const response = await login(data);
        if (response.code === 200 && response.data) {
            const { token, role } = response.data;
            useAuthStore.getState().setToken(token);
            const userProfile = await getUserProfile();
            const userRole = roleMapping[role] || 'student';
            useAuthStore.getState().login({
                id: userProfile.data.id || '',
                firstName: userProfile.data.firstName || '',
                lastName: userProfile.data.lastName || '',
                email: data.email,
                password: data.password,
                role: userRole,
            });
            message.success('Đăng nhập thành công!');
            return response;
        }
        throw new Error(response.message || 'Đăng nhập thất bại.');
    } catch (error: any) {
        message.error(error.message || 'Đã có lỗi xảy ra khi đăng nhập.');
        throw error;
    }
};

export const logoutService = async (): Promise<LogoutResponse> => {
    try {
        const response = await logout();
        if (response.code === 200) {
            useAuthStore.getState().logout();
            message.success('Đăng xuất thành công!');
            return response;
        }
        throw new Error(response.message || 'Đăng xuất thất bại.');
    } catch (error: any) {
        message.error(error.message || 'Đã có lỗi xảy ra khi đăng xuất.');
        throw error;
    }
};

export const refreshTokenService = async (): Promise<AuthResponse> => {
    try {
        const response = await refreshToken();
        if (response.code === 200 && response.data) {
            const { token } = response.data;
            useAuthStore.getState().setToken(token);
            return response;
        }
        throw new Error(response.message || 'Không thể làm mới token.');
    } catch (error: any) {
        message.error(error.message || 'Đã có lỗi xảy ra khi làm mới token.');
        throw error;
    }
};

export const updatePasswordService = async (
    data: UpdatePasswordRequest
): Promise<UserProfileResponse> => {
    try {
        const response = await updatePassword(data);
        if (response.code === 200 && response.data) {
            message.success('Đổi mật khẩu thành công');
            return response;
        }
        throw new Error(response.message || 'Đổi mật khẩu thất bại.');
    } catch (error: any) {
        message.error(error.message || 'Đã có lỗi xảy ra khi đổi mật khẩu.');
        throw error;
    }
};
// services/courseManagementService.ts - Cải thiện
import { message } from 'antd';
<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
import {
    getAllCourses,
    getCourseById,
    createCourse,
    updateCourseInfo,
    updateCourseStatus,
    uploadImage,
    getCategories,
    getOwnCourses,
} from '../api/courseApi';
import type {
    AllCoursesRequest,
    CourseResponse,
    CourseDetailResponse,
    CourseCreateRequest,
    CourseUpdateRequest,
    CourseStatusUpdateRequest, // ✅ Thêm type mới
    UploadResponse,
    CategoryResponse,
} from '../types/course';

export const getAllCoursesService = async (
    data: AllCoursesRequest,
    role: string | undefined
): Promise<CourseResponse> => {
    try {
        const response = role === 'manager' ? await getAllCourses(data) : await getOwnCourses(data);

        if (response.code === 200) {
            return response;
        }
        throw new Error(response.message || 'Lấy danh sách khóa học thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi lấy danh sách khóa học.');
        throw error;
    }
};

// ✅ Thêm service để lấy danh sách giáo viên
export const getTeachersService = async () => {
    try {
        // Sử dụng API filter user để lấy danh sách giáo viên
        const { filterUsersService } = await import('./userService');
        const response = await filterUsersService({
            userRoles: ['TEACHER'],
            isActive: true,
            isDelete: false,
            page: 0,
            size: 100,
        });

        if (response.code === 200) {
            return response.data.content;
        }
        return [];
    } catch (error: any) {
        console.error('Lỗi khi lấy danh sách giáo viên:', error);
        return [];
    }
};

export const getCourseByIdService = async (id: number): Promise<CourseDetailResponse> => {
    try {
        const response = await getCourseById(id);
        if (response.code === 200) {
            return response;
        }
        throw new Error(response.message || 'Lấy chi tiết khóa học thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi lấy chi tiết khóa học.');
        throw error;
    }
};

export const createCourseService = async (
    data: CourseCreateRequest
): Promise<CourseDetailResponse> => {
    try {
        const response = await createCourse(data);
        if (response.code === 200) {
            message.success('Tạo khóa học thành công!');
            return response;
        }
        throw new Error(response.message || 'Tạo khóa học thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi tạo khóa học.');
        throw error;
    }
};

export const updateCourseInfoService = async (
    data: CourseUpdateRequest
): Promise<CourseDetailResponse> => {
    try {
        const response = await updateCourseInfo(data);
        if (response.code === 200) {
            message.success('Cập nhật khóa học thành công!');
            return response;
        }
        throw new Error(response.message || 'Cập nhật khóa học thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi cập nhật khóa học.');
        throw error;
    }
};

// ✅ Tách riêng service cho update status
export const updateCourseStatusService = async (
    data: CourseStatusUpdateRequest
): Promise<CourseDetailResponse> => {
    try {
        const response = await updateCourseStatus(data);
        if (response.code === 200) {
            message.success('Cập nhật trạng thái khóa học thành công!');
            return response;
        }
        throw new Error(response.message || 'Cập nhật trạng thái khóa học thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi cập nhật trạng thái khóa học.');
        throw error;
    }
};

export const uploadImageService = async (formData: FormData): Promise<UploadResponse> => {
    try {
        const response = await uploadImage(formData);
        if (response.code === 200) {
            message.success('Tải ảnh thành công!');
            return response;
        }
        throw new Error(response.message || 'Tải ảnh thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi tải ảnh.');
        throw error;
    }
};

export const getCategoriesService = async (): Promise<CategoryResponse> => {
    try {
        const response = await getCategories();
        if (response.code === 200) {
            return response;
        }
        throw new Error(response.message || 'Lấy danh sách danh mục thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi lấy danh sách danh mục.');
        throw error;
    }
};
<<<<<<< HEAD
<<<<<<< HEAD
=======
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
// src/services/classManagementService.ts
import { message } from 'antd';
import { filterClasses, createClass, updateClass, getClassDetailById } from '../api/classApi';
import type {
    FilterClassesRequest,
    CreateClassRequest,
    UpdateClassRequest,
    ClassPagedResponse,
    ClassDetailResponse,
} from '../types/class';

export const filterClassesService = async (
    data: FilterClassesRequest
): Promise<ClassPagedResponse> => {
    try {
        const response = await filterClasses(data);
        if (response.code !== 200) {
            throw new Error(response.message || 'Lấy danh sách lớp học thất bại.');
        }
        return response;
    } catch (error: any) {
        message.error(
            error.response?.data?.message || 'Đã có lỗi xảy ra khi lấy danh sách lớp học.'
        );
        throw error;
    }
};

export const createClassService = async (
    data: CreateClassRequest
): Promise<ClassDetailResponse> => {
    try {
        const response = await createClass(data);
        if (response.code !== 200) {
            throw new Error(response.message || 'Tạo lớp học thất bại.');
        }
        message.success('Tạo lớp học thành công!');
        return response;
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Đã có lỗi xảy ra khi tạo lớp học.');
        throw error;
    }
};

export const updateClassService = async (
    data: UpdateClassRequest
): Promise<ClassDetailResponse> => {
    try {
        const response = await updateClass(data);
        if (response.code !== 200) {
            throw new Error(response.message || 'Cập nhật lớp học thất bại.');
        }
        message.success('Cập nhật lớp học thành công!');
        return response;
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Đã có lỗi xảy ra khi cập nhật.');
        throw error;
    }
};

// Service riêng cho việc hủy lớp học để code rõ ràng hơn
export const cancelClassService = async (classId: number): Promise<ClassDetailResponse> => {
    try {
        const data: UpdateClassRequest = { id: classId };
        const response = await updateClass(data);
        if (response.code !== 200) {
            throw new Error(response.message || 'Hủy lớp học thất bại.');
        }
        message.success('Hủy lớp học thành công!');
        return response;
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Đã có lỗi xảy ra khi hủy lớp học.');
        throw error;
    }
};

export const getClassByIdService = async (classId: number): Promise<ClassDetailResponse> => {
    try {
        const response = await getClassDetailById(classId);
        if (response.code !== 200) {
            throw new Error(response.message || 'Lấy thông tin lớp học thất bại.');
        }
        return response;
    } catch (error: any) {
        message.error(
            error.response?.data?.message || 'Đã có lỗi xảy ra khi lấy thông tin lớp học.'
        );
        throw error;
    }
};
import { message } from 'antd';
import {
    filterUsers,
    disableUser,
    deleteUser,
    updateUserInfo,
    getUserProfile,
} from '../api/userApi';
import type {
    FilterRequest,
    FilterResponse,
    DisableUserRequest,
    DisableUserResponse,
    DeleteUserRequest,
    DeleteUserResponse,
    UpdateUserInfoRequest,
    UpdateUserInfoResponse,
    UserProfileResponse,
} from '../types/user';

export const filterUsersService = async (data: FilterRequest): Promise<FilterResponse> => {
    try {
        const response = await filterUsers(data);
        if (response.code === 200) {
            // message.success('Lấy danh sách người dùng thành công!');
            return response;
        }
        throw new Error(response.message || 'Lấy danh sách người dùng thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi lấy danh sách người dùng.');
        throw error;
    }
};

export const disableUserService = async (
    data: DisableUserRequest
): Promise<DisableUserResponse> => {
    try {
        const response = await disableUser(data);
        if (response.code === 200) {
            message.success('Cập nhật trạng thái người dùng thành công!');
            return response;
        }
        throw new Error(response.message || 'Cập nhật trạng thái người dùng thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi cập nhật trạng thái người dùng.');
        throw error;
    }
};

export const deleteUserService = async (data: DeleteUserRequest): Promise<DeleteUserResponse> => {
    try {
        const response = await deleteUser(data);
        if (response.code === 200) {
            message.success('Cập nhật trạng thái xóa người dùng thành công!');
            return response;
        }
        throw new Error(response.message || 'Cập nhật trạng thái xóa người dùng thất bại.');
    } catch (error: any) {
        message.error(
            error.response?.data?.message || 'Lỗi khi cập nhật trạng thái xóa người dùng.'
        );
        throw error;
    }
};
export const getUserProfileService = async (): Promise<UserProfileResponse> => {
    try {
        const response = await getUserProfile();
        if (response.code === 200 && response.data) {
            message.success('Lấy thông tin cá nhân thành công');
            return response;
        }
        throw new Error(response.message || 'Lấy thông tin cá nhân thất bại.');
    } catch (error: any) {
        message.error(error.message || 'Đã có lỗi xảy ra khi lấy thông tin cá nhân.');
        throw error;
    }
};

export const updateUserInfoService = async (
    data: UpdateUserInfoRequest
): Promise<UpdateUserInfoResponse> => {
    try {
        const response = await updateUserInfo(data);
        if (response.code === 200) {
            message.success('Cập nhật thông tin người dùng thành công!');
            return response;
        }
        throw new Error(response.message || 'Cập nhật thông tin người dùng thất bại.');
    } catch (error: any) {
        message.error(error.response?.data?.message || 'Lỗi khi cập nhật thông tin người dùng.');
        throw error;
    }
};
// routes/index.ts - Updated with Cart & Orders & Payment Callback
import React from 'react';
import { createBrowserRouter } from 'react-router-dom';
import Home from '../pages/public-page/Home/Home';
import MainLayout from '../layouts/MainLayout/MainLayout';
import Courses from '../pages/public-page/Courses/Course';
import Blog from '../pages/public-page/Blog/Blog';
import Test from '../pages/public-page/Test/Test';
import VideoCourses from '../pages/student/VideoCourses/VideoCourses';
import OfflineClasses from '../pages/teacher/OfflineClasses/OfflineClasses';
import ClassManagement from '../pages/manage/ClassManagement/ClassManagement';
import Dashboard from '../pages/common/Dashboard/Dashboard';
import Profile from '../pages/common/Profile/Profile';
import QuestionBank from '../pages/manage/QuestionBank/QuestionBank';
import Statistics from '../pages/manage/Statistics/Statistics';
import MemberManagement from '../pages/manage/MemberManagement/MemberManagement';
import CourseManagement from '../pages/manage/CourseManagement/CourseManagement';
import BlogApproval from '../pages/manage/BlogApproval/BlogApproval';
import Business from '../pages/manage/Business/Business';
import WriteBlog from '../pages/manage/WriteBlog/WriteBlog';
import Cart from '../pages/student/Cart/Cart';
import Orders from '../pages/student/Orders/Orders';
import OrderStatus from '../pages/student/OrderStatus/OrderStatus';
import ProtectedRoute from '../components/common/ProtectedRoute/ProtectedRoute';
import ClassDetail from 'pages/manage/ClassDetail/ClassDetail';

const router = createBrowserRouter([
    {
        path: '/',
        element: React.createElement(MainLayout),
        children: [
            // ✅ PUBLIC ROUTES
            { path: '/', element: React.createElement(Home) },
            { path: '/courses', element: React.createElement(Courses) },
            { path: '/blog', element: React.createElement(Blog) },
            { path: '/test', element: React.createElement(Test) },
            { path: '/order-status', element: React.createElement(OrderStatus) },

            // ✅ DASHBOARD ROUTES
            {
                path: '/dashboard',
                element: React.createElement(Dashboard),
                children: [
                    // Profile (tất cả roles)
                    {
                        path: 'profile',
                        element: React.createElement(ProtectedRoute, { allowedTab: 'profile' }),
                        children: [{ path: '', element: React.createElement(Profile) }],
                    },

                    // ===== STUDENT ROUTES =====
                    {
                        path: 'video-courses',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'video-courses',
                        }),
                        children: [{ path: '', element: React.createElement(VideoCourses) }],
                    },
                    {
                        path: 'offline-classes',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'offline-classes',
                        }),
                        children: [{ path: '', element: React.createElement(OfflineClasses) }],
                    },
                    {
                        path: 'cart',
                        element: React.createElement(ProtectedRoute, { allowedTab: 'cart' }),
                        children: [{ path: '', element: React.createElement(Cart) }],
                    },
                    {
                        path: 'orders',
                        element: React.createElement(ProtectedRoute, { allowedTab: 'orders' }),
                        children: [{ path: '', element: React.createElement(Orders) }],
                    },
                    // ===== TEACHER ROUTES =====
                    {
                        path: 'class-management',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'class-management',
                        }),
                        children: [
                            { path: '', element: React.createElement(ClassManagement) },
                            { path: ':classId', element: React.createElement(ClassDetail) },
                        ],
                    },
                    {
                        path: 'question-bank',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'question-bank',
                        }),
                        children: [{ path: '', element: React.createElement(QuestionBank) }],
                    },

                    // ===== MANAGER ROUTES =====
                    {
                        path: 'statistics',
                        element: React.createElement(ProtectedRoute, { allowedTab: 'statistics' }),
                        children: [{ path: '', element: React.createElement(Statistics) }],
                    },
                    {
                        path: 'member-management',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'member-management',
                        }),
                        children: [{ path: '', element: React.createElement(MemberManagement) }],
                    },
                    {
                        path: 'course-management',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'course-management',
                        }),
                        children: [{ path: '', element: React.createElement(CourseManagement) }],
                    },
                    {
                        path: 'blog-approval',
                        element: React.createElement(ProtectedRoute, {
                            allowedTab: 'blog-approval',
                        }),
                        children: [{ path: '', element: React.createElement(BlogApproval) }],
                    },
                    {
                        path: 'business',
                        element: React.createElement(ProtectedRoute, { allowedTab: 'business' }),
                        children: [{ path: '', element: React.createElement(Business) }],
                    },

                    // ===== CONSULTANT ROUTES =====
                    {
                        path: 'write-blog',
                        element: React.createElement(ProtectedRoute, { allowedTab: 'write-blog' }),
                        children: [{ path: '', element: React.createElement(WriteBlog) }],
                    },
                ],
            },
        ],
    },
]);

export default router;
<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
// pages/CourseManagement/CourseManagement.tsx - Cải thiện
import { Button, message, Table, Input, Select, DatePicker, Form, Switch, Modal } from 'antd';
import { useEffect, useState, useCallback } from 'react';
import {
    getAllCoursesService,
    updateCourseStatusService,
    getCategoriesService,
} from '../../../services/courseManagementService';
import moment from 'moment';
import './CourseManagement.css';
import type { AllCoursesRequest, Course, Category } from '../../../types/course';
import type { SortOrder } from 'antd/es/table/interface';
import CourseDetailDrawer from '../../../components/manage/CourseManagement/CourseDetailDrawer/CourseDetailDrawer';
import useAuthStore from 'store/authStore';

const { Option } = Select;
const { RangePicker } = DatePicker;

const CourseManagement = () => {
    const [form] = Form.useForm();
    const [loading, setLoading] = useState(false);
    const [courses, setCourses] = useState<Course[]>([]);
    const [categories, setCategories] = useState<Category[]>([]);
    const [currentPage, setCurrentPage] = useState(0);
    const [pageSize, setPageSize] = useState(5);
    // const [totalPages, setTotalPages] = useState(0);
    const [totalElements, setTotalElements] = useState(0);
    const [sortField, setSortField] = useState<string | null>(null);
    const [sortOrder, setSortOrder] = useState<SortOrder | undefined>(undefined);
    const [modalLoading, setModalLoading] = useState(false);
    const [modalState, setModalState] = useState({
        activeOpen: false,
        activeChecked: false,
        deleteOpen: false,
        isDelete: false,
        courseId: null as number | null,
    });
    const [drawerOpen, setDrawerOpen] = useState(false);
    const [selectedCourse, setSelectedCourse] = useState<Course | null>(null);

    const fetchCategories = useCallback(async () => {
        try {
            const response = await getCategoriesService();
            if (response.code === 200) {
                setCategories(response.data);
            }
        } catch (error) {
            console.error('Lỗi khi lấy danh sách danh mục:', error);
        }
    }, []);
    const role = useAuthStore().user?.role;
    const fetchCourses = useCallback(
        async (
            values: any = {},
            page: number = 0,
            size: number = 5,
            sort: string | null = null
        ) => {
            setLoading(true);
            try {
                const { title, dateRange, categories } = values;
                const dataBody: AllCoursesRequest = {
                    fromDate: dateRange?.[0] ? dateRange[0].format('YYYY-MM-DD') : null,
                    toDate: dateRange?.[1] ? dateRange[1].format('YYYY-MM-DD') : null,
                    title: title || null,
                    categories: categories ? [categories] : [],
                    page,
                    size,
                    sort,
                };
                const response = await getAllCoursesService(dataBody, role ?? undefined);
                setCourses(response.data.content);
                // setTotalPages(response.data.totalPages);
                setTotalElements(response.data.totalElements);
                setCurrentPage(response.data.pageable.pageNumber);
            } catch (error) {
                console.error('Lỗi khi lấy danh sách khóa học:', error);
            } finally {
                setLoading(false);
            }
        },
        []
    );

    useEffect(() => {
        fetchCategories();
    }, []);

    useEffect(() => {
        fetchCourses();
    }, [fetchCourses]);

    const handleToggleActive = useCallback((courseId: number, checked: boolean) => {
        setModalState((prev) => ({
            ...prev,
            activeOpen: true,
            activeChecked: checked,
            courseId,
        }));
    }, []);

    // ✅ Cải thiện handleModalActiveOk
    const handleModalActiveOk = async () => {
        if (modalState.courseId === null) return;
        setModalLoading(true);
        try {
            const response = await updateCourseStatusService({
                id: modalState.courseId,
                isActive: modalState.activeChecked,
            });
            if (response.code === 200) {
                message.success(
                    modalState.activeChecked
                        ? 'Duyệt khóa học thành công!'
                        : 'Hủy duyệt khóa học thành công!'
                );
                setCourses(
                    courses.map((course) =>
                        course.id === modalState.courseId
                            ? { ...course, isActive: modalState.activeChecked }
                            : course
                    )
                );
            }
        } catch (error) {
            console.error('Lỗi khi cập nhật trạng thái khóa học:', error);
        } finally {
            setModalLoading(false);
            setModalState((prev) => ({ ...prev, activeOpen: false, courseId: null }));
        }
    };

    const handleModalActiveCancel = () => {
        setModalState((prev) => ({ ...prev, activeOpen: false, courseId: null }));
    };

    const handleDeleteOrRestore = useCallback((courseId: number, isDelete: boolean) => {
        setModalState((prev) => ({
            ...prev,
            deleteOpen: true,
            isDelete,
            courseId,
        }));
    }, []);

    // ✅ Cải thiện handleModalDeleteOk
    const handleModalDeleteOk = async () => {
        if (modalState.courseId === null) return;
        setModalLoading(true);
        try {
            const response = await updateCourseStatusService({
                id: modalState.courseId,
                isDelete: modalState.isDelete,
                ...(modalState.isDelete && { isActive: false }), // ✅ Chỉ set isActive = false khi xóa
            });
            if (response.code === 200) {
                message.success(
                    modalState.isDelete
                        ? 'Xóa khóa học thành công!'
                        : 'Khôi phục khóa học thành công!'
                );
                setCourses(
                    courses.map((course) =>
                        course.id === modalState.courseId
                            ? {
                                  ...course,
                                  isDelete: modalState.isDelete,
                                  isActive: modalState.isDelete ? false : course.isActive,
                              }
                            : course
                    )
                );
            }
        } catch (error) {
            console.error(
                modalState.isDelete ? 'Lỗi khi xóa khóa học:' : 'Lỗi khi khôi phục khóa học:',
                error
            );
        } finally {
            setModalLoading(false);
            setModalState((prev) => ({ ...prev, deleteOpen: false, courseId: null }));
        }
    };

    const handleModalDeleteCancel = () => {
        setModalState((prev) => ({ ...prev, deleteOpen: false, courseId: null }));
    };

    const handleTableChange = (pagination: any, _filters: any, sorter: any) => {
        const { field, order } = sorter;
        const newSortField = field || null;
        const newSortOrder = order as SortOrder;
        setSortField(newSortField);
        setSortOrder(newSortOrder);
        setCurrentPage(pagination.current - 1);
        setPageSize(pagination.pageSize);
        fetchCourses(
            form.getFieldsValue(),
            pagination.current - 1,
            pagination.pageSize,
            newSortField && newSortOrder
                ? `${newSortField},${newSortOrder === 'ascend' ? 'asc' : 'desc'}`
                : null
        );
    };

    const handleRowClick = (record: Course) => {
        setSelectedCourse(record);
        setDrawerOpen(true);
    };

    const handleCreateCourse = () => {
        setSelectedCourse(null);
        setDrawerOpen(true);
    };

    const handleDrawerClose = () => {
        setDrawerOpen(false);
        setSelectedCourse(null);
    };

    const columns = [
        {
            title: 'Tiêu đề',
            dataIndex: 'title',
            key: 'title',
            width: 200,
            ellipsis: true,
            sorter: true,
            sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
            sortOrder: sortField === 'title' ? sortOrder : undefined,
        },
        {
            title: 'Giá (VND)',
            dataIndex: 'price',
            key: 'price',
            width: 120,
            sorter: true,
            sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
            sortOrder: sortField === 'price' ? sortOrder : undefined,
        },
        {
            title: 'Chủ đề',
            dataIndex: 'categoryName',
            key: 'categoryName',
            width: 150,
            render: (categoryName: string) => categoryName || 'Chưa xác định',
        },
        {
            title: 'Tác giả',
            dataIndex: 'authorName',
            key: 'authorName',
            width: 150,
            render: (authorName: string) => authorName || 'Chưa xác định',
        },
        {
            title: 'Ngày tạo',
            dataIndex: 'createdAt',
            key: 'createdAt',
            width: 150,
            render: (createdAt: string) => moment(createdAt).format('DD/MM/YYYY HH:mm'),
            sorter: true,
            sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
            sortOrder: sortField === 'createdAt' ? sortOrder : undefined,
        },
        {
            title: 'Trạng thái',
            dataIndex: 'isActive',
            key: 'isActive',
            width: 100,
            render: (isActive: boolean, record: Course) => (
                <Switch
                    checked={isActive}
                    onChange={(checked) => handleToggleActive(record.id, checked)}
                    disabled={record.isDelete}
                    aria-label={`Bật/tắt trạng thái cho khóa học ${record.title}`}
                    onClick={(_checked, e) => e.stopPropagation()} // ✅ Ngăn event bubbling
                />
            ),
        },
        {
            title: 'Hành động',
            key: 'action',
            width: 150,
            render: (_: any, record: Course) => (
                <div className="action-buttons" onClick={(e) => e.stopPropagation()}>
                    {' '}
                    {/* ✅ Ngăn event bubbling */}
                    {record.isDelete ? (
                        <Button
                            size="small"
                            className="action-button-fixed"
                            onClick={(e) => {
                                e.stopPropagation(); // ✅ Ngăn event bubbling
                                handleDeleteOrRestore(record.id, false);
                            }}
                        >
                            Khôi phục
                        </Button>
                    ) : (
                        <Button
                            danger
                            size="small"
                            className="action-button-fixed"
                            onClick={(e) => {
                                e.stopPropagation(); // ✅ Ngăn event bubbling
                                handleDeleteOrRestore(record.id, true);
                            }}
                        >
                            Xóa
                        </Button>
                    )}
                </div>
            ),
        },
    ];

    return (
        <div className="course-management">
            <h2>Quản Lý Khóa Học</h2>
            <Form
                form={form}
                layout="inline"
                onFinish={(values) =>
                    fetchCourses(
                        values,
                        0,
                        pageSize,
                        sortField && sortOrder
                            ? `${sortField},${sortOrder === 'ascend' ? 'asc' : 'desc'}`
                            : null
                    )
                }
                style={{ marginBottom: 16 }}
                className="search-form"
            >
                <Form.Item name="title" label="Tiêu đề">
                    <Input placeholder="Nhập tiêu đề khóa học" />
                </Form.Item>
                <Form.Item name="categories" label="Chủ đề">
                    <Select placeholder="Chọn chủ đề" allowClear>
                        {categories.map((category) => (
                            <Option key={category.id} value={category.name}>
                                {category.name}
                            </Option>
                        ))}
                    </Select>
                </Form.Item>
                <Form.Item name="dateRange" label="Ngày tạo khóa học">
                    <RangePicker format="DD/MM/YYYY" />
                </Form.Item>
                <div className="form-actions">
                    <Form.Item>
                        <Button type="primary" htmlType="submit" onClick={() => setCurrentPage(0)}>
                            Tìm kiếm
                        </Button>
                    </Form.Item>
                    <Form.Item>
                        <Button
                            onClick={() => {
                                form.resetFields();
                                setSortField(null);
                                setSortOrder(undefined);
                                fetchCourses({}, 0, pageSize, null);
                            }}
                        >
                            Xóa bộ lọc
                        </Button>
                    </Form.Item>
                    <Form.Item>
                        <Button type="primary" onClick={handleCreateCourse}>
                            Tạo khóa học
                        </Button>
                    </Form.Item>
                </div>
            </Form>
            <Table
                columns={columns}
                dataSource={courses}
                loading={loading}
                rowKey="id" // ✅ Thêm rowKey
                pagination={{
                    current: currentPage + 1,
                    pageSize: pageSize,
                    total: totalElements,
                    showSizeChanger: true,
                    pageSizeOptions: ['5', '10', '20', '50'],
                    showTotal: (total, range) => `${range[0]}-${range[1]} của ${total} khóa học`, // ✅ Hiển thị tổng số
                }}
                onChange={handleTableChange}
                rowClassName={(record) => (record.isDelete ? 'deleted-row' : '')} // ✅ Class cho row bị xóa
                onRow={(record) => ({
                    onClick: () => handleRowClick(record),
                    style: { cursor: 'pointer' },
                })}
            />
            <Modal
                title={
                    modalState.activeChecked
                        ? 'Xác nhận duyệt khóa học'
                        : 'Xác nhận hủy duyệt khóa học'
                }
                open={modalState.activeOpen}
                onOk={handleModalActiveOk}
                onCancel={handleModalActiveCancel}
                okText="Xác nhận"
                cancelText="Hủy"
                confirmLoading={modalLoading}
            >
                <p>
                    {modalState.activeChecked
                        ? 'Bạn có chắc chắn muốn duyệt khóa học này?'
                        : 'Bạn có chắc chắn muốn hủy duyệt khóa học này?'}
                </p>
            </Modal>
            <Modal
                title={
                    modalState.isDelete ? 'Xác nhận xóa khóa học' : 'Xác nhận khôi phục khóa học'
                }
                open={modalState.deleteOpen}
                onOk={handleModalDeleteOk}
                onCancel={handleModalDeleteCancel}
                okText="Xác nhận"
                cancelText="Hủy"
                okType={modalState.isDelete ? 'danger' : 'primary'}
                confirmLoading={modalLoading}
            >
                <p>
                    {modalState.isDelete
                        ? 'Bạn có chắc chắn muốn xóa khóa học này? Hành động này không thể hoàn tác.'
                        : 'Bạn có chắc chắn muốn khôi phục khóa học này?'}
                </p>
            </Modal>
            <CourseDetailDrawer
                open={drawerOpen}
                onClose={handleDrawerClose}
                course={selectedCourse}
                categories={categories}
                onCourseUpdated={() =>
                    fetchCourses(
                        form.getFieldsValue(),
                        currentPage,
                        pageSize,
                        sortField && sortOrder
                            ? `${sortField},${sortOrder === 'ascend' ? 'asc' : 'desc'}`
                            : null
                    )
                }
            />
        </div>
    );
};

export default CourseManagement;
.course-management h2 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #1890ff;
}

.course-management .ant-form {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    background: #fff;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.course-management .ant-form-item {
    margin-bottom: 0;
}

.course-management .ant-input,
.course-management .ant-select,
.course-management .ant-picker {
    width: 180px;
}

.course-management .ant-table {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.course-management .ant-table-thead > tr > th {
    background: #fafafa;
    font-weight: 600;
}

.action-buttons {
    display: flex;
    gap: 8px;
}

.action-buttons .ant-btn {
    height: 32px;
    font-size: 14px;
}

.action-buttons .action-button-fixed {
    width: 90px;
}

.form-actions {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
    align-items: center;
    margin-left: auto;
}

@media (max-width: 768px) {
    .course-management {
        margin-left: 0;
        padding: 16px;
    }
<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665

    .course-management .ant-form {
        flex-direction: column;
    }

    .course-management .ant-input,
    .course-management .ant-select,
    .course-management .ant-picker {
        width: 100%;
    }

    .form-actions {
        flex-direction: column;
        gap: 12px;
        width: 100%;
    }

<<<<<<< HEAD
=======

    .course-management .ant-form {
        flex-direction: column;
    }

    .course-management .ant-input,
    .course-management .ant-select,
    .course-management .ant-picker {
        width: 100%;
    }

    .form-actions {
        flex-direction: column;
        gap: 12px;
        width: 100%;
    }

=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
    .form-actions .ant-btn {
        width: 100%;
    }
}
// src/pages/manage/ClassManagement/ClassManagement.tsx
import { useState, useEffect, useCallback } from 'react';
import { Card } from 'antd';
import { filterClassesService } from '../../../services/classManagementService';
import { getTeachersService } from '../../../services/courseManagementService';
import type { Class, FilterClassesRequest } from '../../../types/class';
import type { User } from '../../../types/user';
import ClassFilter from '../../../components/manage/ClassManagement/ClassFilter/ClassFilter';
import ClassTable from '../../../components/manage/ClassManagement/ClassTable/ClassTable';
import ClassFormModal from '../../../components/manage/ClassManagement/ClassFormModal/ClassFormModal';
import CancelClassModal from '../../../components/manage/ClassManagement/CancelClassModal/CancelClassModal';
import './ClassManagement.css';

const ClassManagementPage = () => {
    const [classes, setClasses] = useState<Class[]>([]);
    const [teachers, setTeachers] = useState<User[]>([]);
    const [loading, setLoading] = useState(false);
    const [filters, setFilters] = useState<FilterClassesRequest>({});
    const [pagination, setPagination] = useState({
        current: 1,
        pageSize: 10,
        total: 0,
    });

    const [isFormModalVisible, setIsFormModalVisible] = useState(false);
    const [isCancelModalVisible, setIsCancelModalVisible] = useState(false);
    const [selectedClass, setSelectedClass] = useState<Class | null>(null);

    const fetchClasses = useCallback(
        async (currentFilters: FilterClassesRequest, page: number, size: number) => {
            setLoading(true);
            try {
                const response = await filterClassesService({
                    ...currentFilters,
                    page: page - 1,
                    size: size,
                });
                setClasses(response.data.content);
                // setClasses(response.data);
                setPagination((prev) => ({
                    ...prev,
                    total: response.data.totalElements,
                    current: page,
                    pageSize: size,
                }));
            } catch (error) {
                console.error('Failed to fetch classes:', error);
            } finally {
                setLoading(false);
            }
        },
        []
    );

    const fetchInitialData = useCallback(async () => {
        try {
            // Lấy danh sách giáo viên để đưa vào bộ lọc và form
            const teacherList = await getTeachersService();
            setTeachers(teacherList);
        } catch (error) {
            console.error('Failed to fetch teachers:', error);
        }
    }, []);

    useEffect(() => {
        fetchInitialData();
    }, [fetchInitialData]);

    useEffect(() => {
        fetchClasses(filters, pagination.current, pagination.pageSize);
    }, [filters, fetchClasses]);

    const handleFilter = (newFilters: Partial<FilterClassesRequest>) => {
        setFilters(newFilters);
        // Khi lọc, quay về trang 1
        setPagination((prev) => ({ ...prev, current: 1 }));
        fetchClasses(newFilters, 1, pagination.pageSize);
    };

    const handleTableChange = (newPagination: any) => {
        fetchClasses(filters, newPagination.current, newPagination.pageSize);
    };

    const handleOpenFormModal = (cls: Class | null) => {
        setSelectedClass(cls);
        setIsFormModalVisible(true);
    };

    const handleCloseFormModal = (shouldRefresh: boolean) => {
        setIsFormModalVisible(false);
        if (shouldRefresh) {
            fetchClasses(filters, pagination.current, pagination.pageSize);
        }
    };

    const handleOpenCancelModal = (cls: Class) => {
        setSelectedClass(cls);
        setIsCancelModalVisible(true);
    };

    const handleCloseCancelModal = (shouldRefresh: boolean) => {
        setIsCancelModalVisible(false);
        if (shouldRefresh) {
            fetchClasses(filters, pagination.current, pagination.pageSize);
        }
    };

    return (
        <div className="class-management-container">
            <h2>Quản Lý Lớp Học</h2>
            <Card style={{ marginBottom: 5 }}>
                <ClassFilter
                    onFilter={handleFilter}
                    teachers={teachers}
                    loading={loading}
                    createClassService={() => handleOpenFormModal(null)}
                />
            </Card>

            <Card>

                <ClassTable
                    data={classes}
                    loading={loading}
                    pagination={pagination}
                    onTableChange={handleTableChange}
                    onEdit={handleOpenFormModal}
                    onCancel={handleOpenCancelModal}
                />
            </Card>

            <ClassFormModal
                visible={isFormModalVisible}
                initialData={selectedClass}
                onClose={handleCloseFormModal}
                teachers={teachers}
            />

            <CancelClassModal
                visible={isCancelModalVisible}
                classData={selectedClass}
                onClose={handleCloseCancelModal}
            />
        </div>
    );
};

export default ClassManagementPage;
/* src/pages/manage/ClassManagement/ClassManagement.css */
.class-management-container h2 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #1890ff;
}

// src/pages/manage/ClassDetail/ClassDetail.tsx
import { useEffect, useState } from 'react';
import { useParams, Link, useNavigate } from 'react-router-dom';
import { Spin, message, Tabs, Breadcrumb, Typography, Button, Space } from 'antd';
import { ArrowLeftOutlined } from '@ant-design/icons';
import type { Class } from '../../../types/class';
import { getClassByIdService } from '../../../services/classManagementService';
import './ClassDetail.css';

// Import các component tab vừa tạo
import ClassInfoTab from '../../../components/manage/ClassDetail/ClassInfoTab';
import StudentListTab from '../../../components/manage/ClassDetail/StudentListTab';
import ScheduleTab from '../../../components/manage/ClassDetail/ScheduleTab';

const { TabPane } = Tabs;
const { Title } = Typography;

const ClassDetail = () => {
    const { classId } = useParams<{ classId: string }>();
    const navigate = useNavigate();
    const [classData, setClassData] = useState<Class | null>(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        if (classId) {
            const fetchClassDetails = async () => {
                setLoading(true);
                try {
                    const response = await getClassByIdService(Number(classId));
                    setClassData(response.data);
                } catch (error) {
                    message.error('Không thể tải dữ liệu lớp học.');
                } finally {
                    setLoading(false);
                }
            };
            fetchClassDetails();
        }
    }, [classId]);

    if (loading) {
        return <Spin size="large" className="full-page-spinner" />;
    }

    if (!classData) {
        return <div className="class-detail-container">Không tìm thấy thông tin lớp học.</div>;
    }

    return (
        <div className="class-detail-container">
            <div className="page-header-container">
                <Breadcrumb>
                    <Breadcrumb.Item>
                        <Link to="/dashboard/class-management">Quản lý lớp học</Link>
                    </Breadcrumb.Item>
                    <Breadcrumb.Item>{classData.name}</Breadcrumb.Item>
                </Breadcrumb>

                <Space wrap align="center" className="page-title-container">
                    <Button
                        type="text"
                        icon={<ArrowLeftOutlined />}
                        onClick={() => navigate('/dashboard/class-management')}
                    />
                    <Title level={2} style={{ marginBottom: 0 }}>
                        {classData.name}
                    </Title>
                </Space>
            </div>

            <Tabs defaultActiveKey="1" type="card">
                <TabPane tab="Thông tin chung" key="1">
                    <ClassInfoTab classData={classData} />
                </TabPane>
                <TabPane tab="Danh sách Học viên" key="2">
                    <StudentListTab classData={classData} />
                </TabPane>
                <TabPane tab="Lịch học" key="3">
                    <ScheduleTab classData={classData} />
                </TabPane>
            </Tabs>
        </div>
    );
};

export default ClassDetail;


/* Thêm CSS cho header mới */
.page-header-container {
    background-color: #fff;
    padding: 16px 24px;
    border-radius: 8px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.page-title-container {
    margin-top: 12px;
}

/* CSS cho spinner toàn trang */
.full-page-spinner {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 50vh;
}
import { Button, message, Table, Input, Select, DatePicker, Form, Switch, Modal } from 'antd';
import { useEffect, useState, useCallback } from 'react';
import moment from 'moment';
import {
    filterUsersService,
    disableUserService,
    deleteUserService,
} from '../../../services/userService';
import './MemberManagement.css';
import type { FilterRequest, User, FilterResponse } from '../../../types/user';
import type { SortOrder } from 'antd/es/table/interface';

const { Option } = Select;
const { RangePicker } = DatePicker;

const MemberManagement = () => {
    const [form] = Form.useForm();
    const [loading, setLoading] = useState(false);
    const [users, setUsers] = useState<User[]>([]);
    const [currentPage, setCurrentPage] = useState(0);
    const [pageSize, setPageSize] = useState(5);
    const [totalPages, setTotalPages] = useState(0);
    const [sortField, setSortField] = useState<string | null>(null);
    const [sortOrder, setSortOrder] = useState<SortOrder | undefined>(undefined);
    const [modalLoading, setModalLoading] = useState(false);
    const [modalState, setModalState] = useState({
        activeOpen: false,
        activeChecked: false,
        deleteOpen: false,
        isDelete: false,
        userId: null as number | null,
    });

    const fetchUsers = useCallback(
        async (
            values: any = {},
            page: number = 0,
            size: number = 5,
            sort: string | null = null
        ) => {
            setLoading(true);
            try {
                // const { searchString, email, name, phone, isActive, userRoles, dateRange } = values;
                const { searchString, isActive, userRoles } = values;
                const dataBody: FilterRequest = {
                    searchString: searchString || null,
                    isActive: isActive !== undefined ? isActive : null,
                    userRoles: userRoles ? [userRoles] : null,
                    page,
                    size,
                    sort,
                };
                const response: FilterResponse = await filterUsersService(dataBody);
                setUsers(response.data.content);
                setTotalPages(response.data.totalPages);
                setCurrentPage(response.data.pageable.pageNumber);
            } catch (error) {
                message.error('Lỗi khi lấy danh sách người dùng.');
            } finally {
                setLoading(false);
            }
        },
        []
    );

    const handleToggleActive = useCallback(
        (userId: number, checked: boolean) => {
            setModalState({
                ...modalState,
                activeOpen: true,
                activeChecked: checked,
                userId,
            });
        },
        [modalState]
    );

    const handleModalActiveOk = async () => {
        if (modalState.userId === null) return;
        setModalLoading(true);
        try {
            const response = await disableUserService({
                id: modalState.userId,
                isActive: modalState.activeChecked,
            });
            if (response.code === 200) {
                message.success(
                    modalState.activeChecked
                        ? 'Kích hoạt người dùng thành công!'
                        : 'Vô hiệu hóa người dùng thành công!'
                );
                setUsers(
                    users.map((user) =>
                        user.id === modalState.userId
                            ? { ...user, isActive: modalState.activeChecked }
                            : user
                    )
                );
            }
        } catch (error) {
            message.error('Lỗi khi cập nhật trạng thái người dùng.');
        } finally {
            setModalLoading(false);
            setModalState({ ...modalState, activeOpen: false, userId: null });
        }
    };

    const handleModalActiveCancel = () => {
        setModalState({ ...modalState, activeOpen: false, userId: null });
    };

    const handleDeleteOrRestore = useCallback(
        (userId: number, isDelete: boolean) => {
            setModalState({
                ...modalState,
                deleteOpen: true,
                isDelete,
                userId,
            });
        },
        [modalState]
    );

    const handleModalDeleteOk = async () => {
        if (modalState.userId === null) return;
        setModalLoading(true);
        try {
            const response = await deleteUserService({
                id: modalState.userId,
                isDelete: modalState.isDelete,
                isActive: false,
            });
            if (response.code === 200) {
                message.success(
                    modalState.isDelete
                        ? 'Xóa người dùng thành công!'
                        : 'Khôi phục người dùng thành công!'
                );
                setUsers(
                    users.map((user) =>
                        user.id === modalState.userId
                            ? {
                                  ...user,
                                  isDelete: modalState.isDelete,
                                  isActive: modalState.isDelete ? false : user.isActive,
                              }
                            : user
                    )
                );
            }
        } catch (error) {
            message.error(
                modalState.isDelete ? 'Lỗi khi xóa người dùng.' : 'Lỗi khi khôi phục người dùng.'
            );
        } finally {
            setModalLoading(false);
            setModalState({ ...modalState, deleteOpen: false, userId: null });
        }
    };

    const handleModalDeleteCancel = () => {
        setModalState({ ...modalState, deleteOpen: false, userId: null });
    };

    const handleTableChange = (pagination: any, _filters: any, sorter: any) => {
        const { field, order } = sorter;
        const newSortField = field || null;
        const newSortOrder = order as SortOrder;
        setSortField(newSortField);
        setSortOrder(newSortOrder);
        setCurrentPage(pagination.current - 1);
        setPageSize(pagination.pageSize);
        fetchUsers(
            form.getFieldsValue(),
            pagination.current - 1,
            pagination.pageSize,
            newSortField && newSortOrder
                ? `${newSortField},${newSortOrder === 'ascend' ? 'asc' : 'desc'}`
                : null
        );
    };

    const columns = [
        {
            title: 'Họ và tên',
            key: 'name',
            width: 150,
            render: (record: User) => `${record.firstName} ${record.lastName}`,
            // ellipsis: true,
            // sorter: true,
            // sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
            // sortOrder: sortField === 'name' ? sortOrder : undefined,
        },
        // {
        //   title: 'Email',
        //   dataIndex: 'email',
        //   key: 'email',
        //   width: 200,
        //   sorter: true,
        //   sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
        //   sortOrder: sortField === 'email' ? sortOrder : undefined,
        // },
        {
            title: 'Số điện thoại',
            dataIndex: 'phone',
            key: 'phone',
            width: 150,
        },
        // {
        //   title: 'Ngày sinh',
        //   dataIndex: 'dob',
        //   key: 'dob',
        //   width: 150,
        //   render: (dob: string) => (dob ? moment(dob).format('DD/MM/YYYY') : 'Chưa xác định'),
        //   sorter: true,
        //   sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
        //   sortOrder: sortField === 'dob' ? sortOrder : undefined,
        // },
        {
            title: 'Vai trò',
            dataIndex: 'role',
            key: 'role',
            width: 100,
            render: (role: string) => role || 'Chưa xác định',
        },
        {
            title: 'Ngày tạo',
            dataIndex: 'createdAt',
            key: 'createdAt',
            width: 150,
            render: (dob: string) => (dob ? moment(dob).format('DD/MM/YYYY') : 'Chưa xác định'),
            sorter: true,
            sortDirections: ['ascend', 'descend'] as ('ascend' | 'descend')[],
            sortOrder: sortField === 'createdAt' ? sortOrder : undefined,
        },
        {
            title: 'Trạng thái',
            dataIndex: 'isActive',
            key: 'isActive',
            width: 100,
            render: (isActive: boolean, record: User) => (
                <Switch
                    checked={isActive}
                    onChange={(checked) => handleToggleActive(record.id, checked)}
                    disabled={record.isDelete}
                    aria-label={`Bật/tắt trạng thái cho người dùng ${record.firstName} ${record.lastName}`}
                />
            ),
        },
        {
            title: 'Hành động',
            key: 'action',
            width: 150,
            render: (_: any, record: User) => (
                <div className="action-buttons">
                    {record.isDelete ? (
                        <Button
                            size="small"
                            onClick={() => handleDeleteOrRestore(record.id, false)}
                            className="action-button-fixed"
                        >
                            Khôi phục
                        </Button>
                    ) : (
                        <Button
                            danger
                            size="small"
                            onClick={() => handleDeleteOrRestore(record.id, true)}
                            className="action-button-fixed"
                        >
                            Xóa
                        </Button>
                    )}
                </div>
            ),
        },
    ];

    useEffect(() => {
        fetchUsers();
    }, []);

    return (
        <div className="member-management">
            <h2>Quản Lý Thành Viên</h2>
            <Form
                form={form}
                layout="inline"
                onFinish={(values) =>
                    fetchUsers(
                        values,
                        0,
                        pageSize,
                        sortField && sortOrder
                            ? `${sortField},${sortOrder === 'ascend' ? 'asc' : 'desc'}`
                            : null
                    )
                }
                style={{ marginBottom: 16 }}
                className="search-form"
            >
                <Form.Item name="searchString" label="Tìm kiếm">
                    <Input placeholder="Nhập email, tên hoặc số điện thoại" />
                </Form.Item>
                <Form.Item name="userRoles" label="Vai trò">
                    <Select placeholder="Chọn vai trò" allowClear>
                        <Option value="MANAGER">Quản lý</Option>
                        <Option value="CONSULTANT">Nhân viên</Option>
                        <Option value="STUDENT">Học Sinh</Option>
                        <Option value="TEACHER">Giáo viên</Option>
                    </Select>
                </Form.Item>
                <Form.Item name="isActive" label="Trạng thái">
                    <Select placeholder="Chọn trạng thái" allowClear>
                        <Option value={true}>Kích hoạt</Option>
                        <Option value={false}>Vô hiệu hóa</Option>
                    </Select>
                </Form.Item>
                <Form.Item name="dateRange" label="Ngày tạo">
                    <RangePicker format="DD/MM/YYYY" />
                </Form.Item>
                <div className="form-actions">
                    <Form.Item>
                        <Button type="primary" htmlType="submit" onClick={() => setCurrentPage(0)}>
                            Tìm kiếm
                        </Button>
                    </Form.Item>
                    <Form.Item>
                        <Button
                            onClick={() => {
                                form.resetFields();
                                setSortField(null);
                                setSortOrder(undefined);
                                fetchUsers({}, 0, pageSize, null);
                            }}
                        >
                            Xóa bộ lọc
                        </Button>
                    </Form.Item>
                </div>
            </Form>
            <Table
                columns={columns}
                dataSource={users}
                loading={loading}
                pagination={{
                    current: currentPage + 1,
                    pageSize: pageSize,
                    total: totalPages * pageSize,
                    showSizeChanger: true,
                    pageSizeOptions: ['5', '10', '20', '50'],
                }}
                onChange={handleTableChange}
            />
            <Modal
                title={
                    modalState.activeChecked
                        ? 'Xác nhận kích hoạt người dùng'
                        : 'Xác nhận vô hiệu hóa người dùng'
                }
                open={modalState.activeOpen}
                onOk={handleModalActiveOk}
                onCancel={handleModalActiveCancel}
                okText="Xác nhận"
                cancelText="Hủy"
                confirmLoading={modalLoading}
            >
                <p>
                    {modalState.activeChecked
                        ? 'Bạn có chắc chắn muốn kích hoạt người dùng này?'
                        : 'Bạn có chắc chắn muốn vô hiệu hóa người dùng này?'}
                </p>
            </Modal>
            <Modal
                title={
                    modalState.isDelete
                        ? 'Xác nhận xóa người dùng'
                        : 'Xác nhận khôi phục người dùng'
                }
                open={modalState.deleteOpen}
                onOk={handleModalDeleteOk}
                onCancel={handleModalDeleteCancel}
                okText="Xác nhận"
                cancelText="Hủy"
                okType={modalState.isDelete ? 'danger' : 'primary'}
                confirmLoading={modalLoading}
            >
                <p>
                    {modalState.isDelete
                        ? 'Bạn có chắc chắn muốn xóa người dùng này? Hành động này không thể hoàn tác.'
                        : 'Bạn có chắc chắn muốn khôi phục người dùng này?'}
                </p>
            </Modal>
        </div>
    );
};

export default MemberManagement;
.member-management h2 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #1890ff;
}

.member-management .ant-form {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    background: #fff;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.member-management .ant-form-item {
    margin-bottom: 0;
}

.member-management .ant-input,
.member-management .ant-select,
.member-management .ant-picker {
    width: 180px;
}

.member-management .ant-table {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.member-management .ant-table-thead > tr > th {
    background: #fafafa;
    font-weight: 600;
}

.status-active {
    color: #52c41a;
    font-weight: 500;
}

.status-inactive {
    color: #fa8c16;
    font-weight: 500;
}

.action-buttons {
    display: flex;
    gap: 8px;
}

.action-buttons .ant-btn {
    height: 32px;
    font-size: 14px;
}

.action-buttons .action-button-fixed {
    width: 90px;
}

.deleted-user {
    text-decoration: line-through;
}

.form-actions {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
    align-items: center;
}

@media (max-width: 768px) {
    .member-management {
        margin-left: 0;
        padding: 16px;
    }

    .member-management .ant-form {
        flex-direction: column;
    }

    .member-management .ant-input,
    .member-management .ant-select,
    .member-management .ant-picker {
        width: 100%;
    }

    .form-actions {
        flex-direction: column;
        gap: 12px;
        width: 100%;
    }

<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
    .form-actions .ant-btn {
        width: 100%;
    }
}
// components/CourseManagement/CourseDetailDrawer/CourseDetailDrawer.tsx - Final
import {
    Drawer,
    Form,
    Input,
    Button,
    Select,
    InputNumber,
    Upload,
    message,
    Descriptions,
    Divider,
    Image,
    Typography,
} from 'antd';
import { useState, useEffect } from 'react';
import { UploadOutlined, EyeOutlined, EditOutlined, PlusOutlined } from '@ant-design/icons';
import {
    getCourseByIdService,
    createCourseService,
    updateCourseInfoService,
    uploadImageService,
    getTeachersService,
} from '../../../../services/courseManagementService';
import type {
    Course,
    Category,
    CourseCreateRequest,
    CourseUpdateRequest,
} from '../../../../types/course';
import type { User } from '../../../../types/user';
import moment from 'moment';

const { Option } = Select;
const { Title, Text } = Typography;

interface CourseDetailDrawerProps {
    open: boolean;
    onClose: () => void;
    course: Course | null;
    categories: Category[];
    onCourseUpdated: () => void;
}

const CourseDetailDrawer = ({
    open,
    onClose,
    course,
    categories,
    onCourseUpdated,
}: CourseDetailDrawerProps) => {
    const [form] = Form.useForm();
    const [loading, setLoading] = useState(false);
    const [uploadLoading, setUploadLoading] = useState(false);
    const [fileList, setFileList] = useState<any[]>([]);
    const [thumbnailUrl, setThumbnailUrl] = useState<string | null>(null);
    const [isEditing, setIsEditing] = useState(false);
    const [courseDetails, setCourseDetails] = useState<Course | null>(null);
    const [teachers, setTeachers] = useState<User[]>([]); // ✅ Thêm state cho teachers

    const isCreateMode = !course;
    const isViewMode = course && !isEditing;

    // ✅ Thêm function để fetch teachers
    const fetchTeachers = async () => {
        try {
            const teacherList = await getTeachersService();
            setTeachers(teacherList);
        } catch (error) {
            console.error('Lỗi khi lấy danh sách giáo viên:', error);
        }
    };

    useEffect(() => {
        // ✅ Fetch teachers khi component mount
        fetchTeachers();

        if (course) {
            fetchCourseDetails(course.id);
            setIsEditing(false);
        } else {
            // Create mode
            form.resetFields();
            setThumbnailUrl(null);
            setFileList([]);
            setCourseDetails(null);
            setIsEditing(true);
        }
    }, [course, form]);

    const fetchCourseDetails = async (courseId: number) => {
        try {
            setLoading(true);
            const response = await getCourseByIdService(courseId);
            if (response.code === 200) {
                const courseData = response.data;
                setCourseDetails(courseData);

                // ✅ Map categoryName to categoryId để set form
                const categoryId = categories.find(
                    (cat) => cat.name === courseData.categoryName
                )?.id;
                // ✅ Find authorId từ author object
                const authorId = courseData.author?.id;

                form.setFieldsValue({
                    title: courseData.title,
                    description: courseData.description,
                    price: courseData.price,
                    categoryId: categoryId,
                    authorId: authorId, // ✅ Set authorId cho edit mode
                });

                setThumbnailUrl(courseData.thumbnailUrl);
                setFileList(
                    courseData.thumbnailUrl
                        ? [
                              {
                                  uid: '-1',
                                  name: 'thumbnail.jpg',
                                  url: courseData.thumbnailUrl,
                                  status: 'done',
                              },
                          ]
                        : []
                );
            }
        } catch (error) {
            console.error('Lỗi khi lấy chi tiết khóa học:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleUpload = async ({ file }: any) => {
        if (!file) return;

        const isImage = file.type.startsWith('image/');
        if (!isImage) {
            message.error('Vui lòng chọn file hình ảnh!');
            return;
        }

        const isLt5M = file.size / 1024 / 1024 < 5;
        if (!isLt5M) {
            message.error('Kích thước file phải nhỏ hơn 5MB!');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        try {
            setUploadLoading(true);
            const response = await uploadImageService(formData);
            if (response.code === 200) {
                setThumbnailUrl(response.data);
                setFileList([
                    {
                        uid: file.uid,
                        name: file.name,
                        url: response.data,
                        status: 'done',
                    },
                ]);
                message.success('Tải ảnh lên thành công!');
            }
        } catch (error) {
            console.error('Lỗi khi tải ảnh lên:', error);
            setFileList([]);
            setThumbnailUrl(null);
        } finally {
            setUploadLoading(false);
        }
    };

    const handleRemoveFile = () => {
        setFileList([]);
        setThumbnailUrl(null);
    };

    const onFinish = async (values: any) => {
        // ✅ Validate authorId cho cả create và update
        if (!values.authorId) {
            message.error('Vui lòng chọn giáo viên!');
            return;
        }

        setLoading(true);
        try {
            if (course) {
                // Update existing course
                const updateData: CourseUpdateRequest = {
                    id: course.id,
                    title: values.title,
                    description: values.description,
                    price: values.price,
                    categoryId: values.categoryId,
                    thumbnailUrl: thumbnailUrl || course.thumbnailUrl || '',
                };

                const response = await updateCourseInfoService(updateData);
                if (response.code === 200) {
                    message.success('Cập nhật khóa học thành công!');
                    onCourseUpdated();
                    setIsEditing(false);
                    // Refresh course details
                    await fetchCourseDetails(course.id);
                }
            } else {
                // Create new course
                const createData: CourseCreateRequest = {
                    title: values.title,
                    description: values.description || '',
                    price: values.price,
                    authorId: values.authorId, // ✅ Sử dụng authorId từ form
                    categoryId: values.categoryId,
                    thumbnailUrl: thumbnailUrl || '',
                    isActive: false,
                    isDelete: false,
                };

                const response = await createCourseService(createData);
                if (response.code === 200) {
                    message.success('Tạo khóa học thành công!');
                    onCourseUpdated();
                    onClose();
                }
            }
        } catch (error) {
            console.error(course ? 'Lỗi khi cập nhật khóa học:' : 'Lỗi khi tạo khóa học:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleClose = () => {
        form.resetFields();
        setThumbnailUrl(null);
        setFileList([]);
        setIsEditing(false);
        setCourseDetails(null);
        onClose();
    };

    const handleEdit = () => {
        setIsEditing(true);
    };

    const handleCancelEdit = () => {
        setIsEditing(false);
        // Reset form to original values
        if (courseDetails) {
            const categoryId = categories.find(
                (cat) => cat.name === courseDetails.categoryName
            )?.id;
            const authorId = courseDetails.author?.id;
            form.setFieldsValue({
                title: courseDetails.title,
                description: courseDetails.description,
                price: courseDetails.price,
                categoryId: categoryId,
                authorId: authorId, // ✅ Reset authorId
            });
            setThumbnailUrl(courseDetails.thumbnailUrl);
            setFileList(
                courseDetails.thumbnailUrl
                    ? [
                          {
                              uid: '-1',
                              name: 'thumbnail.jpg',
                              url: courseDetails.thumbnailUrl,
                              status: 'done',
                          },
                      ]
                    : []
            );
        }
    };

    const getTitle = () => {
        if (isCreateMode) return 'Tạo khóa học mới';
        if (isViewMode) return 'Chi tiết khóa học';
        return 'Chỉnh sửa khóa học';
    };

    const getFooterButtons = () => {
        if (isCreateMode) {
            return (
                <div style={{ textAlign: 'right' }}>
                    <Button onClick={handleClose} style={{ marginRight: 8 }}>
                        Hủy
                    </Button>
                    <Button type="primary" loading={loading} onClick={() => form.submit()}>
                        Tạo mới
                    </Button>
                </div>
            );
        }

        if (isViewMode) {
            return (
                <div style={{ textAlign: 'right' }}>
                    <Button onClick={handleClose} style={{ marginRight: 8 }}>
                        Đóng
                    </Button>
                    <Button type="primary" icon={<EditOutlined />} onClick={handleEdit}>
                        Chỉnh sửa
                    </Button>
                </div>
            );
        }

        return (
            <div style={{ textAlign: 'right' }}>
                <Button onClick={handleCancelEdit} style={{ marginRight: 8 }}>
                    Hủy
                </Button>
                <Button type="primary" loading={loading} onClick={() => form.submit()}>
                    Cập nhật
                </Button>
            </div>
        );
    };

    return (
        <Drawer
            title={
                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                    {isCreateMode ? (
                        <PlusOutlined />
                    ) : isViewMode ? (
                        <EyeOutlined />
                    ) : (
                        <EditOutlined />
                    )}
                    {getTitle()}
                </div>
            }
            width={600}
            open={open}
            onClose={handleClose}
            destroyOnClose
            footer={getFooterButtons()}
        >
            {/* ✅ View Mode - Course Details */}
            {isViewMode && courseDetails && (
                <div>
                    <Descriptions column={1} bordered size="small">
                        <Descriptions.Item label="ID">{courseDetails.id}</Descriptions.Item>
                        <Descriptions.Item label="Tiêu đề">{courseDetails.title}</Descriptions.Item>
                        <Descriptions.Item label="Mô tả">
                            {courseDetails.description || 'Chưa có mô tả'}
                        </Descriptions.Item>
                        <Descriptions.Item label="Giá">
                            <Text strong style={{ color: '#1890ff', fontSize: '16px' }}>
                                {new Intl.NumberFormat('vi-VN', {
                                    style: 'currency',
                                    currency: 'VND',
                                }).format(courseDetails.price)}
                            </Text>
                        </Descriptions.Item>
                        <Descriptions.Item label="Chủ đề">
                            {courseDetails.categoryName || 'Chưa xác định'}
                        </Descriptions.Item>
                        <Descriptions.Item label="Tác giả">
                            {courseDetails.authorName || 'Chưa xác định'}
                        </Descriptions.Item>
                        <Descriptions.Item label="Người tạo">
                            {courseDetails.createdByName || 'Chưa xác định'}
                        </Descriptions.Item>
                        <Descriptions.Item label="Ngày tạo">
                            {moment(courseDetails.createdAt).format('DD/MM/YYYY HH:mm')}
                        </Descriptions.Item>
                        <Descriptions.Item label="Ngày cập nhật">
                            {courseDetails.updatedAt
                                ? moment(courseDetails.updatedAt).format('DD/MM/YYYY HH:mm')
                                : 'Chưa cập nhật'}
                        </Descriptions.Item>
                        <Descriptions.Item label="Trạng thái">
                            <span
                                style={{
                                    color: courseDetails.isActive ? '#52c41a' : '#faad14',
                                    fontWeight: 'bold',
                                }}
                            >
                                {courseDetails.isActive ? 'Đã kích hoạt' : 'Chưa kích hoạt'}
                            </span>
                        </Descriptions.Item>
                        <Descriptions.Item label="Tình trạng">
                            <span
                                style={{
                                    color: courseDetails.isDelete ? '#ff4d4f' : '#52c41a',
                                    fontWeight: 'bold',
                                }}
                            >
                                {courseDetails.isDelete ? 'Đã xóa' : 'Hoạt động'}
                            </span>
                        </Descriptions.Item>
                    </Descriptions>

                    {courseDetails.thumbnailUrl && (
                        <div style={{ marginTop: 16 }}>
                            <Title level={5}>Hình ảnh thumbnail:</Title>
                            <Image
                                src={courseDetails.thumbnailUrl}
                                alt="Course thumbnail"
                                style={{ maxWidth: '100%', borderRadius: 8 }}
                                fallback="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RUG8OH+QWdgY1YbSXZJM7K7lDOSByNvZOchsH1YLa+Kp7lKvFYuO0GOWFH4Q=="
                            />
                        </div>
                    )}

                    {courseDetails.lessons && courseDetails.lessons.length > 0 && (
                        <div style={{ marginTop: 16 }}>
                            <Divider />
                            <Title level={5}>Bài học ({courseDetails.lessons.length})</Title>
                            {/* TODO: Implement lessons list */}
                            <Text type="secondary">Danh sách bài học sẽ được hiển thị ở đây</Text>
                        </div>
                    )}
                </div>
            )}

            {/* ✅ Edit/Create Mode - Form */}
            {(isEditing || isCreateMode) && (
                <Form
                    form={form}
                    layout="vertical"
                    onFinish={onFinish}
                    initialValues={{
                        price: 0,
                    }}
                >
                    <Form.Item
                        name="title"
                        label="Tiêu đề"
                        rules={[
                            { required: true, message: 'Vui lòng nhập tiêu đề khóa học!' },
                            { min: 5, message: 'Tiêu đề phải có ít nhất 5 ký tự!' },
                            { max: 200, message: 'Tiêu đề không được quá 200 ký tự!' },
                        ]}
                    >
                        <Input placeholder="Nhập tiêu đề khóa học" />
                    </Form.Item>

                    <Form.Item
                        name="description"
                        label="Mô tả"
                        rules={[{ max: 1000, message: 'Mô tả không được quá 1000 ký tự!' }]}
                    >
                        <Input.TextArea
                            rows={4}
                            placeholder="Nhập mô tả khóa học (tùy chọn)"
                            showCount
                            maxLength={1000}
                        />
                    </Form.Item>

                    <Form.Item
                        name="price"
                        label="Giá (VND)"
                        rules={[
                            { required: true, message: 'Vui lòng nhập giá khóa học!' },
                            { type: 'number', min: 0, message: 'Giá phải lớn hơn hoặc bằng 0!' },
                        ]}
                    >
                        <InputNumber
                            min={0}
                            style={{ width: '100%' }}
                            placeholder="Nhập giá khóa học"
                        />
                    </Form.Item>

                    <Form.Item
                        name="categoryId"
                        label="Chủ đề"
                        rules={[{ required: true, message: 'Vui lòng chọn chủ đề!' }]}
                    >
                        <Select placeholder="Chọn chủ đề" allowClear>
                            {categories.map((category) => (
                                <Option key={category.id} value={category.id}>
                                    {category.name}
                                </Option>
                            ))}
                        </Select>
                    </Form.Item>

                    {/* ✅ Thêm dropdown chọn giáo viên */}
                    <Form.Item
                        name="authorId"
                        label="Giáo viên"
                        rules={[{ required: true, message: 'Vui lòng chọn giáo viên!' }]}
                    >
                        <Select
                            placeholder="Chọn giáo viên"
                            allowClear
                            showSearch
                            filterOption={(input, option) =>
                                (option?.children?.toString()?.toLowerCase() ?? '').indexOf(
                                    input.toLowerCase()
                                ) >= 0
                            }
                        >
                            {teachers.map((teacher) => (
                                <Option key={teacher.id} value={teacher.id}>
                                    {`${teacher.firstName} ${teacher.lastName}`}
                                    {teacher.phone && ` - ${teacher.phone}`}
                                </Option>
                            ))}
                        </Select>
                    </Form.Item>

                    <Form.Item name="thumbnail" label="Hình ảnh thumbnail">
                        <Upload
                            fileList={fileList}
                            customRequest={handleUpload}
                            onRemove={handleRemoveFile}
                            maxCount={1}
                            accept="image/*"
                            showUploadList={{
                                showPreviewIcon: true,
                                showRemoveIcon: true,
                            }}
                        >
                            <Button
                                icon={<UploadOutlined />}
                                loading={uploadLoading}
                                disabled={fileList.length >= 1}
                            >
                                {fileList.length >= 1 ? 'Đã tải lên' : 'Tải ảnh lên'}
                            </Button>
                        </Upload>
                        <div style={{ marginTop: 8, fontSize: 12, color: '#666' }}>
                            Chỉ chấp nhận file hình ảnh, kích thước tối đa 5MB
                        </div>
                    </Form.Item>

                    {thumbnailUrl && (
                        <Form.Item label="Xem trước">
                            <Image
                                src={thumbnailUrl}
                                alt="Thumbnail preview"
                                style={{
                                    maxWidth: '100%',
                                    borderRadius: 4,
                                    border: '1px solid #d9d9d9',
                                }}
                            />
                        </Form.Item>
                    )}
                </Form>
            )}
        </Drawer>
    );
};

<<<<<<< HEAD
export default CourseDetailDrawer;
.ant-drawer-content-wrapper {
=======
export default CourseDetailDrawer;.ant-drawer-content-wrapper {
<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
    padding: 16px;
}

.ant-drawer .ant-form-item {
    margin-bottom: 16px;
}

.ant-drawer .ant-btn {
    width: 100%;
}
<<<<<<< HEAD
<<<<<<< HEAD
=======
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665
// src/components/manage/ClassManagement/ClassTable/ClassTable.tsx
import { Table, Button, Space, Tag } from 'antd';
import type { ColumnsType } from 'antd/es/table';
import moment from 'moment';
import { EditOutlined, StopOutlined } from '@ant-design/icons';
import type { Class, ClassStatus } from '../../../../types/class';
import { Link } from 'react-router-dom';

interface ClassTableProps {
    data: Class[];
    loading: boolean;
    pagination: any;
    onTableChange: (pagination: any) => void;
    onEdit: (cls: Class) => void;
    onCancel: (cls: Class) => void;
}

const statusColors: Record<ClassStatus, string> = {
    PENDING: 'gold',
    ACTIVE: 'green',
    FINISHED: 'blue',
    CANCELED: 'red',
};

const ClassTable = ({
    data,
    loading,
    pagination,
    onTableChange,
    onEdit,
    onCancel,
}: ClassTableProps) => {
    const columns: ColumnsType<Class> = [
        {
            title: 'Tên lớp học',
            dataIndex: 'name',
            key: 'name',
            width: 200,
            render(text, record) {
                return <Link to={`/dashboard/class-management/${record.id}`}>{text}</Link>;
            },
        },
        { title: 'Tiêu đề', dataIndex: 'title', key: 'title', width: 200, ellipsis: true },
        {
            title: 'Giáo viên',
            dataIndex: ['teacher', 'lastName'],
            key: 'teacher',
            render: (_, record) => `${record.teacher.firstName} ${record.teacher.lastName}`,
        },
        {
            title: 'Ngày tạo',
            dataIndex: 'createdAt',
            key: 'createdAt',
            render: (text) => moment(text).format('DD/MM/YYYY'),
        },
        {
            title: 'Trạng thái',
            dataIndex: 'status',
            key: 'status',
            render: (status: ClassStatus) => (
                <Tag color={statusColors[status] || 'default'}>{status}</Tag>
            ),
        },
        {
            title: 'Hành động',
            key: 'action',
            align: 'center',
            render: (_, record) => (
                <Space size="middle">
                    <Button type="link" icon={<EditOutlined />} onClick={() => onEdit(record)}>
                        Sửa
                    </Button>
                    <Button
                        danger
                        type="link"
                        icon={<StopOutlined />}
                        onClick={() => onCancel(record)}
                        disabled={record.status === 'CANCELED' || record.status === 'FINISHED'}
                    >
                        Hủy
                    </Button>
                </Space>
            ),
        },
    ];

    return (
        <Table
            columns={columns}
            dataSource={data}
            loading={loading}
            rowKey="id"
            pagination={pagination}
            onChange={onTableChange}
        />
    );
};

export default ClassTable;
// src/components/manage/ClassManagement/ClassFormModal/ClassFormModal.tsx
import { useEffect } from 'react';
import { Modal, Form, Input, Select } from 'antd';
import type { Class, CreateClassRequest, UpdateClassRequest } from '../../../../types/class';
import {
    createClassService,
    updateClassService,
} from '../../../../services/classManagementService';
import type { User } from '../../../../types/user';

const { Option } = Select;
const { TextArea } = Input;

interface ClassFormModalProps {
    visible: boolean;
    onClose: (shouldRefresh: boolean) => void;
    initialData: Class | null;
    teachers: User[];
}

const ClassFormModal = ({ visible, onClose, initialData, teachers }: ClassFormModalProps) => {
    const [form] = Form.useForm();
    const isEditMode = !!initialData;

    useEffect(() => {
        if (visible) {
            if (isEditMode) {
                form.setFieldsValue({
                    ...initialData,
                    teacher: initialData.teacher?.id,
                });
            } else {
                form.resetFields();
            }
        }
    }, [visible, initialData, form, isEditMode]);

    const handleOk = async () => {
        try {
            const values = await form.validateFields();
            if (isEditMode) {
                const payload: UpdateClassRequest = {
                    id: initialData.id,
                    ...values,
                };
                await updateClassService(payload);
            } else {
                const payload: CreateClassRequest = {
                    ...values,
                };
                await createClassService(payload);
            }
            onClose(true);
        } catch (error) {
            console.error('Failed to save class:', error);
        }
    };

    return (
        <Modal
            title={isEditMode ? 'Chỉnh sửa Lớp học' : 'Tạo Lớp học mới'}
            open={visible}
            onOk={handleOk}
            onCancel={() => onClose(false)}
            okText="Lưu"
            cancelText="Hủy"
            destroyOnClose
        >
            <Form form={form} layout="vertical" name="classForm">
                <Form.Item
                    name="name"
                    label="Tên lớp học"
                    rules={[{ required: true, message: 'Vui lòng nhập tên lớp học!' }]}
                >
                    <Input />
                </Form.Item>
                <Form.Item
                    name="title"
                    label="Tiêu đề"
                    rules={[{ required: true, message: 'Vui lòng nhập tiêu đề!' }]}
                >
                    <Input />
                </Form.Item>
                <Form.Item name="description" label="Mô tả">
                    <TextArea rows={4} />
                </Form.Item>
                <Form.Item
                    name="teacher"
                    label="Giáo viên"
                    rules={[{ required: true, message: 'Vui lòng chọn giáo viên!' }]}
                >
                    <Select placeholder="Chọn giáo viên" allowClear>
                        {teachers.map((teacher) => (
                            <Option key={teacher.id} value={teacher.id}>
                                {`${teacher.firstName} ${teacher.lastName}`}
                            </Option>
                        ))}
                    </Select>
                </Form.Item>
            </Form>
        </Modal>
    );
};

export default ClassFormModal;
// src/components/manage/ClassManagement/ClassFilter/ClassFilter.tsx
import { Form, Input, Select, DatePicker, Button, Row, Col } from 'antd';
import type { User } from '../../../../types/user';
import { PlusOutlined } from '@ant-design/icons';

const { RangePicker } = DatePicker;
const { Option } = Select;

interface ClassFilterProps {
    onFilter: (values: any) => void;
    createClassService: (data: any) => void;
    teachers: User[];
    loading: boolean;
}

const ClassFilter = ({ onFilter, teachers, loading, createClassService }: ClassFilterProps) => {
    const [form] = Form.useForm();

    const handleFinish = (values: any) => {
        const filters = {
            ...values,
            fromDate: values.dateRange?.[0]?.format('YYYY-MM-DD'),
            toDate: values.dateRange?.[1]?.format('YYYY-MM-DD'),
            dateRange: undefined,
        };
        onFilter(filters);
    };

    const handleReset = () => {
        form.resetFields();
        onFilter({});
    };

    return (
        <Form form={form} layout="inline" onFinish={handleFinish} className="class-filter-form">
            <Row gutter={16}>
                <Col span={8}>
                    <Form.Item name="searchString" label="Tìm kiếm">
                        <Input placeholder="Nhập tên, tiêu đề lớp học..." allowClear />
                    </Form.Item>
                </Col>
                <Col span={8}>
                    <Form.Item name="idTeacher" label="Giáo viên">
                        <Select placeholder="Chọn giáo viên" allowClear>
                            {teachers.map((teacher) => (
                                <Option key={teacher.id} value={teacher.id}>
                                    {`${teacher.firstName} ${teacher.lastName}`}
                                </Option>
                            ))}
                        </Select>
                    </Form.Item>
                </Col>
                {/* <Col span={8}>
                    <Form.Item name="statusClass" label="Trạng thái">
                        <Select mode="multiple" placeholder="Chọn trạng thái" allowClear>
                            {CLASS_STATUSES.map((status) => (
                                <Option key={status} value={status}>
                                    {status}
                                </Option>
                            ))}
                        </Select>
                    </Form.Item>
                </Col> */}
                <Col span={8}>
                    <Form.Item name="dateRange" label="Ngày tạo">
                        <RangePicker style={{ width: '100%' }} />
                    </Form.Item>
                </Col>
                <Col
                    span={16}
                    style={{
                        textAlign: 'right',
                        alignSelf: 'flex-end',
                        marginLeft: 'auto',
                        marginTop: 16,
                    }}
                >
                    <Button
                        type="primary"
                        icon={<PlusOutlined />}
                        onClick={createClassService}
                        style={{ marginRight: 8 }}
                    >
                        Thêm lớp học mới
                    </Button>
                    <Button
                        type="primary"
                        htmlType="submit"
                        loading={loading}
                        style={{ marginRight: 8 }}
                    >
                        Tìm kiếm
                    </Button>
                    <Button onClick={handleReset} disabled={loading}>
                        Xóa bộ lọc
                    </Button>
                </Col>
            </Row>
        </Form>
    );
};

export default ClassFilter;
// src/components/manage/ClassManagement/CancelClassModal/CancelClassModal.tsx
import { Modal } from 'antd';
import { ExclamationCircleOutlined } from '@ant-design/icons';
import { cancelClassService } from '../../../../services/classManagementService';
import type { Class } from '../../../../types/class';

interface CancelClassModalProps {
    visible: boolean;
    onClose: (shouldRefresh: boolean) => void;
    classData: Class | null;
}

const CancelClassModal = ({ visible, onClose, classData }: CancelClassModalProps) => {
    if (!classData) return null;

    const handleConfirm = async () => {
        try {
            await cancelClassService(classData.id);
            onClose(true);
        } catch (error) {
            console.error('Failed to cancel class:', error);
            onClose(false);
        }
    };

    return (
        <Modal
            title={
                <>
                    <ExclamationCircleOutlined style={{ color: 'red', marginRight: 8 }} />
                    Xác nhận hủy lớp học
                </>
            }
            open={visible}
            onOk={handleConfirm}
            onCancel={() => onClose(false)}
            okText="Xác nhận"
            cancelText="Hủy"
            okType="danger"
        >
            <p>
                Bạn có chắc chắn muốn hủy lớp học <strong>"{classData.name}"</strong> không? Hành
                động này sẽ chuyển trạng thái của lớp học sang CANCELED.
            </p>
        </Modal>
    );
};

export default CancelClassModal;
// src/components/manage/ClassDetail/StudentListTab.tsx
import { Card } from 'antd';
import type { Class } from '../../../types/class';

interface StudentListTabProps {
    classData: Class;
}

const StudentListTab = ({ classData }: StudentListTabProps) => {
    // Bạn có thể dùng classData.id để gọi API lấy danh sách học viên ở đây

    return (
        <Card>
            <p>
                Đây là khu vực để quản lý danh sách học viên của lớp{' '}
                <strong>{classData.name}</strong>.
            </p>
            {/* TODO: Thêm logic, bảng hiển thị, và các nút thêm/xóa học viên */}
        </Card>
    );
};

export default StudentListTab;
// src/components/manage/ClassDetail/ScheduleTab.tsx
import { Card } from 'antd';
import type { Class } from '../../../types/class';

interface ScheduleTabProps {
    classData: Class;
}

const ScheduleTab = ({ classData }: ScheduleTabProps) => {
    // Bạn có thể dùng classData.id để gọi API lấy lịch học

    return (
        <Card>
            <p>
                Đây là khu vực để quản lý lịch học (thời khóa biểu) của lớp{' '}
                <strong>{classData.name}</strong>.
            </p>
            {/* TODO: Thêm logic, lịch hiển thị, và các chức năng quản lý lịch học */}
        </Card>
    );
};

export default ScheduleTab;
// src/components/manage/ClassDetail/ClassInfoTab.tsx
import { Card, Descriptions } from 'antd';
import moment from 'moment';
import type { Class } from '../../../types/class';

interface ClassInfoTabProps {
    classData: Class;
}

const ClassInfoTab = ({ classData }: ClassInfoTabProps) => {
    return (
        <Card>
            <Descriptions bordered column={1}>
                <Descriptions.Item label="Tên lớp học">{classData.name}</Descriptions.Item>
                <Descriptions.Item label="Tiêu đề">{classData.title}</Descriptions.Item>
                <Descriptions.Item label="Giáo viên">{`${classData.teacher.firstName} ${classData.teacher.lastName}`}</Descriptions.Item>
                {/* <Descriptions.Item label="Trạng thái">{classData.status}</Descriptions.Item> */}
                <Descriptions.Item label="Ngày tạo">
                    {moment(classData.createdAt).format('DD/MM/YYYY HH:mm')}
                </Descriptions.Item>
                <Descriptions.Item label="Mô tả">
                    {classData.description || 'Không có mô tả'}
                </Descriptions.Item>
            </Descriptions>
        </Card>
    );
};

export default ClassInfoTab;






<<<<<<< HEAD
>>>>>>> 0d819b82640d0089ec3f3e64fd6854818f5c2f85
=======
>>>>>>> b252bbff32e7fe0f77534d7a4ecfd1ae4fb7b665

